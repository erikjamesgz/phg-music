"use strict";function r(r){if(!r||"string"!=typeof r)return[];const t=r.split("\n"),l=[];t.forEach(r=>{const t=function(r){const t=[],l=/\[(\d{2}):(\d{2})\.(\d{2,3})\]/g,i=[];let e;for(;null!==(e=l.exec(r));){const r=60*parseInt(e[1])*1e3+1e3*parseInt(e[2])+parseInt(e[3].padEnd(3,"0"));i.push(r)}let c=r.replace(l,"").trim();return c=c.replace(/<-?\d+,-?\d+>/g,""),i.forEach(r=>{t.push({time:r,text:c})}),t}(r);t.length>0&&l.push(...t)}),l.sort((r,t)=>r.time-t.time);return l.filter((r,t)=>0===t||""!==r.text.trim())}function t(r){return!(!r||"string"!=typeof r)&&/\[\d{1,2}:\d{2}\.\d{1,3}\]/.test(r)}exports.extractLyricsFromMusicData=function(r){var l,i,e;if(console.log("[lyric] extractLyricsFromMusicData 输入:",{hasMusicData:!!r,musicDataKeys:r?Object.keys(r):[],rawLyric:null==(l=null==r?void 0:r.lyric)?void 0:l.substring(0,50),rawLxlyric:null==(i=null==r?void 0:r.lxlyric)?void 0:i.substring(0,50),rawRlyric:null==(e=null==r?void 0:r.rlyric)?void 0:e.substring(0,50)}),!r)return console.log("[lyric] musicData 为空，返回空歌词"),{lyric:"",tlyric:"",rlyric:"",lxlyric:""};let c=r.lyric||"",n=r.tlyric||"",s=r.rlyric||"",o=r.lxlyric||"";console.log("[lyric] 原始字段长度:",{lyricLength:c.length,tlyricLength:n.length,rlyricLength:s.length,lxlyricLength:o.length});const y=t(c),a=t(o),u=t(s);console.log("[lyric] 时间标签检查结果:",{lyricHasTimeTag:y,lxlyricHasTimeTag:a,rlyricHasTimeTag:u}),!y&&a&&(console.log("[lyric] lyric 无时间标签，使用 lxlyric"),c=o),y||a||!u||(console.log("[lyric] lyric 和 lxlyric 都无时间标签，使用 rlyric"),c=s);const g={lyric:c,tlyric:n,rlyric:s,lxlyric:o};return console.log("[lyric] extractLyricsFromMusicData 输出:",{lyricLength:g.lyric.length,tlyricLength:g.tlyric.length,lyricPreview:g.lyric.substring(0,100)}),g},exports.getCurrentLyricIndex=function(r,t){if(!r||0===r.length)return-1;const l=1e3*t;for(let i=r.length-1;i>=0;i--)if(l>=r[i].time)return i;return 0},exports.mergeLyrics=function(r,t){return t&&0!==t.length?r.map(r=>{const l=t.find(t=>Math.abs(t.time-r.time)<100);return{...r,translation:l?l.text:""}}):r.map(r=>({...r,translation:""}))},exports.parseLyric=r,exports.parseTranslation=function(t){return r(t)};
