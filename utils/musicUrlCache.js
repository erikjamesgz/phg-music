"use strict";const c=require("../common/vendor.js"),e={isLoading:!1,info:null};function n(c,e,n="kg"){return`@music_url__${c}_${e}_${n}`}async function o(e,o="128k",r,s="kg"){try{const i=n(e,o,s);c.index.setStorageSync(i,r),console.log("[MusicUrlCache] 保存缓存:",i)}catch(i){console.error("[MusicUrlCache] 保存缓存失败:",i)}}async function r(e,o="128k",r="kg"){try{const s=n(e,o,r);return!!c.index.getStorageSync(s)}catch(s){return console.error("[MusicUrlCache] 检查缓存失败:",s),!1}}exports.getCachedMusicUrl=async function(e,o="128k",r="kg"){try{const s=n(e,o,r),i=c.index.getStorageSync(s);return i?(console.log("[MusicUrlCache] 命中缓存:",s),i):null}catch(s){console.error("[MusicUrlCache] 读取缓存失败:",s)}},exports.isMusicUrlCached=r,exports.preloadNextMusic=async function(c,n,s="128k"){if(!c||!c.id)return;if(e.isLoading)return;if(await r(c.id,s))console.log("[MusicUrlCache] 下一首已有缓存，无需预加载:",c.name);else{e.isLoading=!0,e.info=c,console.log("[MusicUrlCache] 开始预加载下一首:",c.name);try{const e=await n(c,s);e&&e.url&&(await o(c.id,s,e.url),console.log("[MusicUrlCache] 预加载成功:",c.name))}catch(i){console.error("[MusicUrlCache] 预加载失败:",i.message)}finally{e.isLoading=!1,e.info=null}}},exports.setCachedMusicUrl=o;
