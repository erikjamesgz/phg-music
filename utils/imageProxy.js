"use strict";const e=[{name:"original",url:"",enabled:!0},{name:"wsrv",url:"https://wsrv.nl/?url=",enabled:!0},{name:"weserv",url:"https://images.weserv.nl/?url=",enabled:!0},{name:"jina",url:"https://r.jina.ai/http://",enabled:!0}],t={},r="/static/images/default-cover.png",n=(n,a=0)=>{if(!n)return r;if(n.startsWith("https://"))return n;if(n.startsWith("/")||n.startsWith("./")||n.startsWith("../"))return n;if(!n.startsWith("http://"))return r;let l;if(a>=0&&a<e.length)l=e[a];else{const r=((r=0)=>{for(let n=r;n<e.length;n++){const r=e[n],a=t[r.name]||0;if(r.enabled&&a<3)return{proxy:r,index:n}}return null})(0);r&&(l=r.proxy)}return l?"original"===l.name?n:"jina"===l.name?`${l.url}${n.replace("http://","")}`:`${l.url}${encodeURIComponent(n)}`:(console.error("[ImageProxy] 没有可用的代理服务器"),r)};exports.handleImageError=(r,a,l=0)=>{if(!a)return null;const s=l+1;var o;if(l<e.length&&(o=e[l].name,t[o]=(t[o]||0)+1,console.warn(`[ImageProxy] 代理 ${o} 失败次数: ${t[o]}`)),s<e.length){const t=n(a,s);return console.log(`[ImageProxy] 代理 ${e[l].name} 失败，尝试 ${e[s].name}: ${t}`),r&&r.target&&(r.target.src=t),t}const i=(u=a)?u.replace(/^http:\/\//i,"https://"):u;var u;return console.log(`[ImageProxy] 所有代理都失败，尝试直接转换为 HTTPS: ${i}`),r&&r.target&&(r.target.src=i),i},exports.proxyImageUrl=n;
