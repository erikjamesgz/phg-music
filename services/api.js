"use strict";const t=require("../utils/index.js"),e=require("../utils/http.js"),s=require("../utils/crypto/index.js");require("../common/vendor.js");const{formatFileSize:a,formatTime:r}=t.format,l=t=>{if(!t)return"00:00";const e=Math.floor(t/60),s=Math.floor(t%60);return(e<10?"0"+e:e)+":"+(s<10?"0"+s:s)},i={getHotKeywords:(t="all")=>e.http.get("/api/search/hot",{source:t}),getWyHotSearch:()=>e.http.get("https://music.163.com/api/search/chart/detail",{id:"HOT_SEARCH_SONG#@#"}),getTxHotSearch:()=>e.http.post("https://u.y.qq.com/cgi-bin/musicu.fcg",{comm:{ct:"19",cv:"1803",guid:"0",patch:"118",psrf_access_token_expiresAt:0,psrf_qqaccess_token:"",psrf_qqopenid:"",psrf_qqunionid:"",tmeAppID:"qqmusic",tmeLoginType:0,uin:"0",wid:"0"},hotkey:{method:"GetHotkeyForQQMusicPC",module:"tencent_musicsoso_hotkey.HotkeyService",param:{search_id:"",uin:0}}},{headers:{Referer:"https://y.qq.com/portal/player.html"}}),getKgHotSearch:()=>e.http.get("http://mobilecdnbj.kugou.com/api/v3/rank/song",{version:"9108",ranktype:"2",plat:"0",pagesize:"20",area_code:"1",page:"1",volid:"35050",rankid:"6666",with_res_tag:"1"}),getKwHotSearch:()=>e.http.get("http://hotword.kuwo.cn/hotword.s",{prod:"kwplayer_ar_9.3.0.1",corp:"kuwo",newver:2,vipver:"9.3.0.1",source:"kwplayer_ar_9.3.0.1_40.apk",p2p:1,notrace:0,uid:0,plat:"kwplayer_ar",rformat:"json",encoding:"utf8",tabid:1},{headers:{"User-Agent":"Dalvik/2.1.0 (Linux; U; Android 9;)"}}),getMgHotSearch:()=>e.http.get("http://jadeite.migu.cn:7090/music_search/v3/search/hotword"),searchKwSongs:(t,s=1,a=30)=>e.http.get("http://search.kuwo.cn/r.s",{client:"kt",all:t,pn:s-1,rn:a,uid:"794762570",ver:"kwplayer_ar_9.2.2.1",vipver:"1",show_copyright_off:"1",newver:"1",ft:"music",cluster:"0",strategy:"2012",encoding:"utf8",rformat:"json",vermerge:"1",mobi:"1",issubtitle:"1"}).then(t=>{if(!t||!t.abslist)return{source:"kw",list:[]};const e=t.abslist.map(t=>{let e=[];if(t.N_MINFO){const s=t.N_MINFO.split(";"),a=/level:(\w+),bitrate:(\d+),format:(\w+),size:([\w.]+)/;for(let t of s){const s=t.match(a);if(s){switch(s[2]){case"4000":e.push("flac24bit");break;case"2000":e.push("flac");break;case"320":e.push("320k");break;case"128":e.push("128k")}}}}return{id:t.MUSICRID.replace("MUSIC_",""),musicrid:t.MUSICRID,name:t.SONGNAME,singer:t.ARTIST,album:{name:t.ALBUM||"未知专辑",picUrl:t.web_albumpic_small||""},al:{picUrl:t.web_albumpic_small||""},source:"kw",pic:t.web_albumpic_small||"",url:"",quality:e.join(","),duration:1e3*t.DURATION||0,artists:[{name:t.ARTIST}]}});return{source:"kw",list:e,total:parseInt(t.TOTAL)||e.length,allPage:Math.ceil((parseInt(t.TOTAL)||e.length)/a)}}).catch(t=>(console.error("酷我音乐搜索失败:",t),{source:"kw",list:[]})),searchKgSongs:(t,s=1,a=30)=>e.http.get("https://songsearch.kugou.com/song_search_v2",{keyword:t,page:s,pagesize:a,userid:"0",clientver:"",platform:"WebFilter",filter:2,iscorrection:1,privilege_filter:0,area_code:1}).then(t=>{if(!t||!t.data||!t.data.lists)return{source:"kg",list:[]};const e=t.data.lists.map(t=>{const e=t.FileName||"",s=e.split(" - "),a=s[0]||"",r=s[1]||e;let l="";return t.SQFileSize&&t.SQFileSize>0?l="SQ":t.HQFileSize&&t.HQFileSize>0&&(l="HQ"),{id:t.FileHash,name:r,singer:a,album:{name:t.AlbumName||"未知专辑",picUrl:""},al:{picUrl:""},source:"kg",pic:"",url:"",quality:l,duration:1e3*t.Duration||0,artists:[{name:a}]}});return{source:"kg",list:e,total:t.data.total||e.length,allPage:Math.ceil((t.data.total||e.length)/a)}}).catch(t=>(console.error("酷狗音乐搜索失败:",t),{source:"kg",list:[]})),searchTxSongs:(t,s=1,a=30)=>e.http.post("https://u.y.qq.com/cgi-bin/musicu.fcg",{comm:{ct:11,cv:"1003006",v:"1003006",guid:"0",uin:"0"},req:{method:"DoSearchForQQMusicDesktop",module:"music.search.SearchCgiService",param:{query:t,page_num:s,num_per_page:a,search_type:0}}},{headers:{Referer:"https://y.qq.com/portal/player.html"}}).then(t=>{if(!(t&&t.req&&t.req.data&&t.req.data.body&&t.req.data.body.song&&t.req.data.body.song.list))return{source:"tx",list:[]};const e=t.req.data.body.song.list.map(t=>{let e=[];const s=t.file;s&&(s.size_128mp3>0&&e.push("128k"),s.size_320mp3>0&&e.push("320k"),s.size_flac>0&&e.push("flac"),s.size_hires>0&&e.push("flac24bit"));const a=t.singer?t.singer.map(t=>({name:t.name,id:t.mid})):[],r=a.map(t=>t.name).join("/");return{id:t.mid,name:t.name,singer:r,album:{name:t.album?t.album.name:"未知专辑",id:t.album?t.album.mid:"",picUrl:t.album&&t.album.mid?`https://y.qq.com/music/photo_new/T002R300x300M000${t.album.mid}.jpg`:""},al:{picUrl:t.album&&t.album.mid?`https://y.qq.com/music/photo_new/T002R300x300M000${t.album.mid}.jpg`:""},source:"tx",pic:t.album&&t.album.mid?`https://y.qq.com/music/photo_new/T002R300x300M000${t.album.mid}.jpg`:"",url:"",quality:e.join(","),duration:1e3*t.interval||0,artists:a}});return{source:"tx",list:e,total:t.req.data.body.song.totalnum||e.length,allPage:Math.ceil((t.req.data.body.song.totalnum||e.length)/a)}}).catch(t=>(console.error("QQ音乐搜索失败:",t),{source:"tx",list:[]})),searchWySongs:(t,s=1,l=30)=>e.http.get("https://music.163.com/api/search/get",{s:t,type:"1",offset:(s-1)*l,limit:l,csrf_token:""}).then(t=>{if(!t||200!==t.code)return console.error("网易云音乐搜索失败:",t),{source:"wy",list:[]};const e=t.result.songs||[];if(!e.length)return{source:"wy",list:[]};return{list:e.map(t=>{const e=[],s={};let l;if(t.privilege&&"hires"==t.privilege.maxBrLevel&&(l=t.hr?a(t.hr.size):null,e.push({type:"flac24bit",size:l}),s.flac24bit={size:l}),t.privilege)switch(t.privilege.maxbr){case 999e3:l=t.sq?a(t.sq.size):null,e.push({type:"flac",size:l}),s.flac={size:l};break;case 32e4:l=t.h?a(t.h.size):null,e.push({type:"320k",size:l}),s["320k"]={size:l};break;case 192e3:case 128e3:l=t.l?a(t.l.size):null,e.push({type:"128k",size:l}),s["128k"]={size:l}}e.reverse();const i=t.artists?t.artists.map(t=>t.name).join("、"):"";return{id:t.id,name:t.name,singer:i,artists:t.artists?t.artists.map(t=>({id:t.id,name:t.name})):[],album:{id:t.album?t.album.id:null,name:t.album?t.album.name:"未知专辑",picUrl:t.album?t.album.picUrl:""},al:{picUrl:t.album?t.album.picUrl:""},albumName:t.album?t.album.name:"未知专辑",albumId:t.album?t.album.id:null,source:"wy",interval:r(t.duration/1e3),duration:t.duration,songmid:t.id.toString(),img:t.album?t.album.picUrl:"",lrc:null,types:e,_types:s,typeUrl:{},quality:e.length>0?e[0].type:null}}),allPage:Math.ceil((t.result.songCount||0)/l),limit:l,total:t.result.songCount||0,source:"wy"}}).catch(t=>(console.error("网易云音乐搜索失败:",t),{source:"wy",list:[]})),createMgSignature(t,e){const a="963B7AA0D21511ED807EE5846EC87D20";return{sign:s.md5(`${e}6cdc72a439cef99a3418d2a78aa28c73yyapp2d16148780a1dcc7408e06336b98cfd50${a}${t}`),deviceId:a}},searchMgSongs(t,s=1,r=30){const i=Date.now().toString(),o=this.createMgSignature(i,t),c=`https://jadeite.migu.cn/music_search/v3/search/searchAll?isCorrect=0&isCopyright=1&searchSwitch=%7B%22song%22%3A1%2C%22album%22%3A0%2C%22singer%22%3A0%2C%22tagSong%22%3A1%2C%22mvSong%22%3A0%2C%22bestShow%22%3A1%2C%22songlist%22%3A0%2C%22lyricSong%22%3A0%7D&pageSize=${r}&text=${encodeURIComponent(t)}&pageNo=${s}&sort=0&sid=USS`;return e.http.request({url:c,method:"GET",header:{uiVersion:"A_music_3.6.1",deviceId:o.deviceId,timestamp:i,sign:o.sign,channel:"0146921","User-Agent":"Mozilla/5.0 (Linux; U; Android 11.0.0; zh-cn; MI 11 Build/OPR1.170623.032) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30"}}).then(t=>{if(!t||!t.songResultData||!t.songResultData.resultList)return{source:"mg",list:[]};const e=t.songResultData.resultList,s=[],i=new Set;return e.forEach(t=>{t.forEach(t=>{if(!t.songId||!t.copyrightId||i.has(t.copyrightId))return;i.add(t.copyrightId);const e=[],r={};t.audioFormats&&t.audioFormats.forEach(t=>{let s;switch(t.formatType){case"PQ":s=a(t.asize??t.isize),e.push({type:"128k",size:s}),r["128k"]={size:s};break;case"HQ":s=a(t.asize??t.isize),e.push({type:"320k",size:s}),r["320k"]={size:s};break;case"SQ":s=a(t.asize??t.isize),e.push({type:"flac",size:s}),r.flac={size:s};break;case"ZQ24":s=a(t.asize??t.isize),e.push({type:"flac24bit",size:s}),r.flac24bit={size:s}}});let o=t.img3||t.img2||t.img1||null;var c;o&&!/https?:/.test(o)&&(o="http://d.musicapp.migu.cn"+o),s.push({singer:(c=t.singerList,c?c.map(t=>t.name).join("、"):""),name:t.name,albumName:t.album,albumId:t.albumId,songmid:t.songId,copyrightId:t.copyrightId,source:"mg",interval:l(t.duration),img:o,lrc:null,lrcUrl:t.lrcUrl,mrcUrl:t.mrcurl,trcUrl:t.trcUrl,types:e,_types:r,typeUrl:{},id:t.copyrightId,album:{name:t.album||"未知专辑",picUrl:o},al:{picUrl:o},duration:1e3*t.duration||0,artists:t.singerList?t.singerList.map(t=>({name:t.name,id:t.id})):[],quality:e.length>0?e[0].type:null})})}),{source:"mg",list:s,total:t.songResultData.totalCount||s.length,allPage:Math.ceil((t.songResultData.totalCount||s.length)/r)}}).catch(t=>(console.error("咪咕音乐搜索失败:",t),{source:"mg",list:[]}))},searchSongs(t,e="all",s=1,a=30){switch(e){case"kw":return this.searchKwSongs(t,s,a);case"kg":return this.searchKgSongs(t,s,a);case"tx":return this.searchTxSongs(t,s,a);case"wy":return this.searchWySongs(t,s,a);case"mg":return this.searchMgSongs(t,s,a);default:return Promise.all([this.searchKwSongs(t,s,a).catch(()=>({source:"kw",list:[]})),this.searchKgSongs(t,s,a).catch(()=>({source:"kg",list:[]})),this.searchTxSongs(t,s,a).catch(()=>({source:"tx",list:[]})),this.searchWySongs(t,s,a).catch(()=>({source:"wy",list:[]})),this.searchMgSongs(t,s,a).catch(()=>({source:"mg",list:[]}))]).then(t=>{let e=[],s=0,a=1;for(const r of t)r&&r.list&&r.list.length>0&&(e=[...e,...r.list],s+=r.total||0,a=Math.max(a,r.allPage||1));return{source:"all",list:e,total:s,allPage:a}})}},searchWyPlaylists:(t,s=1,a=20)=>e.http.get("https://music.163.com/api/search/get",{s:t,type:"1000",offset:String((s-1)*a),limit:String(a),csrf_token:""},{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Referer:"https://music.163.com/"}}).then(t=>{if(!t||!t.result||!t.result.playlists)return{source:"wy",list:[]};const e=t.result.playlists.map(t=>({id:t.id,name:t.name,coverImgUrl:t.coverImgUrl,playCount:t.playCount,trackCount:t.trackCount,creator:t.creator?t.creator.nickname:"",description:t.description,source:"wy"}));return{list:e,total:t.result.playlistCount||e.length,allPage:Math.ceil((t.result.playlistCount||e.length)/a),source:"wy"}}).catch(t=>(console.error("网易云音乐歌单搜索失败:",t),{source:"wy",list:[]})),searchTxPlaylists(t,s=1,a=20){const r="https://u.y.qq.com/cgi-bin/musicu.fcg",l={comm:{ct:11,cv:"1003006",v:"1003006",guid:"0",uin:"0"},req:{method:"DoSearchForQQMusicDesktop",module:"music.search.SearchCgiService",param:{query:t,page_num:s,num_per_page:a,search_type:3}}};return console.log("[searchTxPlaylists] 请求URL:",r),console.log("[searchTxPlaylists] 请求参数:",l),e.http.post(r,l,{headers:{Referer:"https://y.qq.com/portal/player.html"}}).then(t=>{if(console.log("[searchTxPlaylists] 响应结果:",t),!(t&&t.req&&t.req.data&&t.req.data.body&&t.req.data.body.songlist&&t.req.data.body.songlist.list))return console.error("[searchTxPlaylists] 响应数据格式错误:",t),{source:"tx",list:[]};const e=t.req.data.body.songlist.list.map(t=>({id:String(t.dissid),name:t.dissname,coverImgUrl:t.imgurl,playCount:t.listennum,trackCount:t.song_count||0,creator:t.creator?t.creator.name:"",time:t.createtime||null,description:t.desc||"",source:"tx"}));return console.log("[searchTxPlaylists] 解析后列表数量:",e.length),{list:e,total:t.req.data.body.songlist.totalnum||e.length,allPage:Math.ceil((t.req.data.body.songlist.totalnum||e.length)/a),source:"tx"}}).catch(t=>(console.error("QQ音乐歌单搜索失败:",t),{source:"tx",list:[]}))},searchKgPlaylists:(t,s=1,a=20)=>e.http.get("http://msearchretry.kugou.com/api/v3/search/special",{keyword:t,page:s,pagesize:a,showtype:10,filter:0,version:7910,sver:2}).then(t=>{if(!t||!t.data||!t.data.info)return{source:"kg",list:[]};const e=t.data.info.map(t=>({id:t.specialid,name:t.specialname,coverImgUrl:t.imgurl,playCount:t.playcount||0,trackCount:t.songcount||0,creator:t.nickname||"",time:t.publishtime||t.publish_time||null,description:t.intro||"",source:"kg"}));return{list:e,total:t.data.total||e.length,allPage:Math.ceil((t.data.total||e.length)/a),source:"kg"}}).catch(t=>(console.error("酷狗音乐歌单搜索失败:",t),{source:"kg",list:[]})),searchKwPlaylists(t,s=1,a=20){const r="https://search.kuwo.cn/r.s",l={all:t,pn:s-1,rn:a,rformat:"json",encoding:"utf8",ver:"mbox",vipver:"MUSIC_8.7.7.0_BCS37",plat:"pc",devid:"28156413",ft:"playlist",pay:0,needliveshow:0};return console.log("[searchKwPlaylists] 请求URL:",r),console.log("[searchKwPlaylists] 请求参数:",l),e.http.get(r,l).then(t=>{console.log("[searchKwPlaylists] 响应结果类型:",typeof t),console.log("[searchKwPlaylists] 响应结果:",t);let e=t;if("string"==typeof t)try{const s=t.replace(/'/g,'"');e=JSON.parse(s),console.log("[searchKwPlaylists] JSON解析成功")}catch(r){return console.error("[searchKwPlaylists] JSON解析失败:",r),{source:"kw",list:[]}}if(!e||!e.abslist)return console.error("[searchKwPlaylists] 响应数据格式错误:",e),{source:"kw",list:[]};const s=e.abslist.map(t=>({id:String(t.playlistid),name:t.name,coverImgUrl:t.pic,playCount:t.playcnt||0,trackCount:t.songnum||0,creator:t.nickname||"",description:t.intro||"",source:"kw"}));return console.log("[searchKwPlaylists] 解析后列表数量:",s.length),{list:s,total:e.total||s.length,allPage:Math.ceil((e.total||s.length)/a),source:"kw"}}).catch(t=>(console.error("酷我音乐歌单搜索失败:",t),{source:"kw",list:[]}))},searchMgPlaylists(t,s=1,a=20){const r=encodeURIComponent('{"song":0,"album":0,"singer":0,"tagSong":0,"mvSong":0,"songlist":1,"bestShow":0}');return e.http.get("https://app.c.nf.migu.cn/MIGUM2.0/v1.0/content/search_all.do",{isCopyright:1,isCorrect:1,pageNo:s,pageSize:a,searchSwitch:r,sort:0,text:t},{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36"}}).then(t=>{if(console.log("[searchMgPlaylists] 响应结果:",t),!t||"000000"!==t.code)return console.error("[searchMgPlaylists] API返回错误状态码:",null==t?void 0:t.code),{source:"mg",list:[]};if(!t.songListResultData||!t.songListResultData.result)return console.error("[searchMgPlaylists] 响应数据格式错误:",t),{source:"mg",list:[]};const e=t.songListResultData.result.map(t=>({id:t.id,name:t.name,coverImgUrl:t.musicListPicUrl,playCount:parseInt(t.playNum)||0,trackCount:parseInt(t.musicNum)||0,creator:"",description:"",source:"mg"}));return console.log("[searchMgPlaylists] 解析后列表数量:",e.length),{list:e,total:parseInt(t.songListResultData.totalCount)||e.length,allPage:Math.ceil((parseInt(t.songListResultData.totalCount)||e.length)/a),source:"mg"}}).catch(t=>(console.error("咪咕音乐歌单搜索失败:",t),{source:"mg",list:[]}))},searchPlaylists(t,e="all",s=1,a=20){switch(e){case"wy":return this.searchWyPlaylists(t,s,a);case"tx":return this.searchTxPlaylists(t,s,a);case"kg":return this.searchKgPlaylists(t,s,a);case"kw":return this.searchKwPlaylists(t,s,a);case"mg":return this.searchMgPlaylists(t,s,a);default:const e=5;return console.log("[searchPlaylists] 开始聚合搜索，关键词:",t,"每平台数量:",e),Promise.all([this.searchWyPlaylists(t,s,e).catch(t=>(console.error("[searchPlaylists] 网易云搜索失败:",t),{source:"wy",list:[]})),this.searchTxPlaylists(t,s,e).catch(t=>(console.error("[searchPlaylists] QQ音乐搜索失败:",t),{source:"tx",list:[]})),this.searchKgPlaylists(t,s,e).catch(t=>(console.error("[searchPlaylists] 酷狗搜索失败:",t),{source:"kg",list:[]})),this.searchKwPlaylists(t,s,e).catch(t=>(console.error("[searchPlaylists] 酷我搜索失败:",t),{source:"kw",list:[]})),this.searchMgPlaylists(t,s,e).catch(t=>(console.error("[searchPlaylists] 咪咕搜索失败:",t),{source:"mg",list:[]}))]).then(t=>{var e;console.log("[searchPlaylists] 各平台搜索结果:",t.map(t=>{var e;return{source:t.source,count:(null==(e=t.list)?void 0:e.length)||0}}));let s=[],a=0,r=1;for(const l of t)console.log(`[searchPlaylists] 处理 ${l.source} 平台结果，数量:`,(null==(e=l.list)?void 0:e.length)||0),l&&l.list&&l.list.length>0&&(s=[...s,...l.list],a+=l.total||0,r=Math.max(r,l.allPage||1));return console.log("[searchPlaylists] 合并后总数量:",s.length),s.sort((t,e)=>(e.playCount||0)-(t.playCount||0)),console.log("[searchPlaylists] 排序后前5条:",s.slice(0,5).map(t=>({name:t.name,source:t.source,playCount:t.playCount}))),{source:"all",list:s,total:a,allPage:r}})}},searchWyAlbums:(t,s=1,a=20)=>e.http.get("https://music.163.com/api/search/get",{s:t,type:10,offset:(s-1)*a,limit:a}).then(t=>{if(!t||200!==t.code||!t.result||!t.result.albums)return{source:"wy",list:[],total:0};return{source:"wy",list:t.result.albums.map(t=>({id:t.id,name:t.name,artist:t.artist?t.artist.name:"",artistId:t.artist?t.artist.id:"",picUrl:t.picUrl,blurPicUrl:t.blurPicUrl,publishTime:t.publishTime,size:t.size,description:t.description,source:"wy"})),total:t.result.albumCount||0}}),searchAlbums(t,e="all",s=1,a=20){switch(e){case"wy":return this.searchWyAlbums(t,s,a);case"tx":return this.searchTxAlbums(t,s,a);case"kg":return this.searchKgAlbums(t,s,a);case"kw":return this.searchKwAlbums(t,s,a);case"mg":return this.searchMgAlbums(t,s,a);default:return Promise.all([this.searchWyAlbums(t,s,a).catch(()=>({source:"wy",list:[],total:0})),this.searchTxAlbums(t,s,a).catch(()=>({source:"tx",list:[],total:0})),this.searchKgAlbums(t,s,a).catch(()=>({source:"kg",list:[],total:0})),this.searchKwAlbums(t,s,a).catch(()=>({source:"kw",list:[],total:0})),this.searchMgAlbums(t,s,a).catch(()=>({source:"mg",list:[],total:0}))]).then(t=>{let e=[],s=0;for(const a of t)a&&a.list&&a.list.length>0&&(e=[...e,...a.list],s+=a.total||0);return{source:"all",list:e,total:s}})}},searchTxAlbums:(t,s=1,a=20)=>e.http.post("https://u.y.qq.com/cgi-bin/musicu.fcg",{comm:{ct:11,cv:"1003006",v:"1003006",guid:"0",uin:"0"},album:{method:"SearchAlbumMobile",module:"music.album.AlbumSearchCgiService",param:{query:t,page_num:s,num_per_page:a,search_type:10}}},{headers:{Referer:"https://y.qq.com/portal/player.html"}}).then(t=>{if(!t||0!==t.album.code||!t.album.data||!t.album.data.list)return{source:"tx",list:[],total:0};return{source:"tx",list:t.album.data.list.map(t=>({id:t.albumId,name:t.albumName,artist:t.singerName||"",artistId:t.singerId||"",picUrl:`https://y.gtimg.cn/music/photo_new/T002R500x500M000${t.albumMID}.jpg`,publishTime:t.publicTime,size:t.totalSongNum,description:"",source:"tx"})),total:t.album.data.total||0}}),searchKgAlbums:(t,s=1,a=20)=>e.http.get("https://songsearch.kugou.com/album_search_v2",{keyword:t,page:s,pagesize:a,showtype:1},{headers:{Referer:"https://servicewechat.com/wx2d02f54a4e4c4027/devtools/page-frame.html"}}).then(t=>{if(!t||1!==t.status||!t.data||!t.data.lists)return{source:"kg",list:[],total:0};return{source:"kg",list:t.data.lists.map(t=>({id:t.albumId,name:t.albumName,artist:t.artistName||"",artistId:"",picUrl:t.imgUrl||"",publishTime:t.publishTime||"",size:t.songCount||0,description:t.description||"",source:"kg"})),total:t.data.total||0}}),searchKwAlbums:(t,s=1,a=20)=>e.http.get("https://search.kuwo.cn/search_album",{key:t,pn:s,rn:a},{headers:{Referer:"https://servicewechat.com/wx2d02f54a4e4c4027/devtools/page-frame.html"}}).then(t=>{if(!t||!t.albumlist)return{source:"kw",list:[],total:0};return{source:"kw",list:t.albumlist.map(t=>({id:t.albumid,name:t.albumname,artist:t.artistname||"",artistId:t.artistid||"",picUrl:t.img||"",publishTime:t.publishtime||"",size:t.songnum||0,description:t.info||"",source:"kw"})),total:t.RES_NUM||0}}),searchMgAlbums:(t,s=1,a=20)=>e.http.get("https://migu.cn/music_search/v3/search/searchAll",{isCorrect:1,isCopyright:1,searchSwitch:'{"song":0,"album":1,"singer":0,"tagSong":0,"mvSong":0,"bestShow":0,"songlist":0,"lyricSong":0}',pageSize:a,text:t,pageNo:s,sort:0},{headers:{Referer:"https://servicewechat.com/wx2d02f54a4e4c4027/devtools/page-frame.html"}}).then(t=>{if(!t||"000000"!==t.code||!t.data||!t.data.album)return{source:"mg",list:[],total:0};return{source:"mg",list:(t.data.album||[]).map(t=>({id:t.id,name:t.name,artist:t.singerName||"",artistId:t.singerId||"",picUrl:t.imgItems&&t.imgItems[0]?t.imgItems[0].img:"",publishTime:t.publishTime||"",size:t.totalCount||0,description:t.description||"",source:"mg"})),total:t.data.total||0}}),getSuggestions:t=>e.http.post("https://music.163.com/weapi/search/suggest/web",{s:t},{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36"},isNetease:!0}).then(t=>t&&t.result&&t.result.songs?t.result.songs.map(t=>t.name):[]).catch(t=>(console.error("获取搜索建议失败:",t),[]))};exports.searchApi=i;
