"use strict";const e=require("../../common/vendor.js"),l=require("../../utils/system.js"),a=require("../../utils/api/songlist.js"),o=require("../../utils/api/songlist-direct.js"),t=require("../../store/modules/list.js"),s=require("../../store/modules/player.js"),i=require("../../utils/imageProxy.js");if(!Array){e.resolveComponent("custom-tabbar")()}Math||(n+r)();const n=()=>"../../uni_modules/roc-icon-plus/components/roc-icon-plus/roc-icon-plus.js",r=()=>"../../components/player/MiniPlayer.js",u={__name:"index",setup(n){const r=e.ref(""),u=e.ref(""),c=e.ref(""),v=e.ref(!1),g=e.ref(!1),d=e.ref(""),h=e.ref(""),S=e.ref(""),m=e.ref(""),p=e.ref(l.getStatusBarHeight()),f=e.computed(()=>({height:`${p.value}px`,width:"100%"})),y=e.ref(""),I=e.ref(""),L=e.ref(""),x=e.ref(""),T=e.ref(""),P=e.ref(0),_=e.ref(""),M=e.ref([]),D=e.ref(!1),w=e.ref(!0),U=e.ref(1),b=e.ref([]),C=e.ref(1),k=e.computed(()=>{var e;E.value;const l=t.listStore.state.playInfo.playerListId,a=t.listStore.state.tempList.meta,o=t.listStore.state.playInfo.playIndex;console.log("[Sharelist] currentSongIndex 计算:",{playerListId:l,tempListMetaId:null==a?void 0:a.id,currentListId:O.value,playIndex:o,songsLength:M.value.length});const i=null==(e=s.playerStore.state.currentSong)?void 0:e.id;if(console.log("[Sharelist] 当前播放歌曲ID:",i),l===t.LIST_IDS.TEMP){const e=null==a?void 0:a.id;if(e&&(e===O.value||e.startsWith("local_"))||e===O.value){if(o>=0&&o<M.value.length)return o;if(i){const e=M.value.findIndex(e=>e.id===i);return console.log("[Sharelist] 临时列表匹配，在songs中查找索引:",i,"结果:",e),e}}return console.log("[Sharelist] 临时列表不匹配当前列表，返回 -1"),-1}if(l===O.value){if(o>=0&&o<M.value.length)return console.log("[Sharelist] 当前页面歌单播放，使用 playIndex:",o),o;if(i){const e=M.value.findIndex(e=>e.id===i);return console.log("[Sharelist] 在songs中查找索引:",i,"结果:",e),e}return console.log("[Sharelist] 当前页面歌单播放，但未找到歌曲，返回 -1"),-1}if(l===t.LIST_IDS.DEFAULT&&i){const e=M.value.findIndex(e=>e.id===i);return console.log("[Sharelist] 在songs中查找索引:",i,"结果:",e),e}return console.log("[Sharelist] 不在播放当前列表，返回 -1"),-1});e.computed(()=>k.value>=0&&M.value.length>k.value?M.value[k.value]:null);const A=e.computed(()=>s.playerStore.state.isPlaying),E=e.ref(0);e.watch(()=>s.playerStore.state.currentSong,(e,l)=>{console.log("[Sharelist] playerStore.currentSong 变化:",null==e?void 0:e.name,"ID:",null==e?void 0:e.id),E.value++},{deep:!0}),e.watch(()=>[t.listStore.state.playInfo.playerListId,t.listStore.state.playInfo.playIndex],(e,l)=>{console.log("[Sharelist] playInfo 变化:",e),E.value++},{deep:!0});const N=e.ref(!1),R=()=>{N.value="true"===e.index.getStorageSync("darkMode"),console.log("[Sharelist] 初始化暗黑模式:",N.value)},$=e.ref(0),j=({height:e,isShowing:l})=>{console.log("[Sharelist] MiniPlayer 高度变化:",e,"是否显示:",l),$.value=l?e:0},q=e.ref(0),z=e=>e?a.formatPlayCount(e):"0",O=e.ref(""),B=e.ref(!1),Q=()=>(O.value||(O.value=`${h.value}_${Date.now()}`),O.value),H=(e,l="name",a="、")=>{if(!e)return"未知歌手";if(Array.isArray(e)){const o=[];return e.forEach(e=>{let a=e[l];a&&o.push(a)}),o.length>0?o.join(a):"未知歌手"}return String(e||"未知歌手")},J=e=>e.types?e.types.some(e=>"flac"===e.type||"flac24bit"===e.type||"SQ"===e.type):"SQ"===e.quality,F=()=>{e.index.navigateBack()},W=(e,l)=>{if(!L.value)return;let a=0;L.value.includes("wsrv.nl")?a=1:L.value.includes("weserv.nl")?a=2:L.value.includes("jina.ai")&&(a=3);const o=i.handleImageError(e,L.value,a);o&&(L.value=o)},K=async()=>{if(0===M.value.length)return;if(console.log("[Sharelist] 播放全部"),console.log("[Sharelist] 是否是本地歌单:",B.value),B.value)return console.log("[Sharelist] 本地歌单，直接切换到对应列表播放"),t.listStore.setPlayerListId(O.value),void(await G(0,!1));console.log("[Sharelist] 在线歌单，使用临时列表播放，添加到试听列表");const e=Q();t.listStore.setTempList(t.LIST_IDS.TEMP,[],{}),t.listStore.setTempList(t.LIST_IDS.TEMP,M.value,{id:e,source:h.value,name:I.value}),t.listStore.setPlayerListId(t.LIST_IDS.TEMP),await G(0,!0)},G=async(l,a=!0)=>{var o,i,n;const r=M.value[l];if(r){console.log("[Sharelist] ========== 播放歌曲开始 =========="),console.log("[Sharelist] 歌曲索引:",l),console.log("[Sharelist] 是否添加到试听列表:",a),console.log("[Sharelist] 是否是本地歌单:",B.value);try{const e={standard:"320k",high:"flac",lossless:"flac24bit",low:"128k"}[s.playerStore.getState().audioQuality||"standard"]||"320k";let l;if(console.log(`[Sharelist] 使用音质 ${e} 获取歌曲播放URL`),B.value){console.log("[Sharelist] 本地歌单，使用临时列表播放，不添加到试听列表");const e=`local_${O.value}`;t.listStore.setTempList(t.LIST_IDS.TEMP,[],{}),t.listStore.setTempList(t.LIST_IDS.TEMP,M.value,{id:e,source:h.value,name:I.value}),t.listStore.setPlayerListId(t.LIST_IDS.TEMP),l=t.LIST_IDS.TEMP,a=!1}else{console.log("[Sharelist] 在线歌单，使用临时列表播放，添加到试听列表");const e=Q();t.listStore.setTempList(t.LIST_IDS.TEMP,[],{}),t.listStore.setTempList(t.LIST_IDS.TEMP,M.value,{id:e,source:h.value,name:I.value}),t.listStore.setPlayerListId(t.LIST_IDS.TEMP),l=t.LIST_IDS.TEMP,a=!0}if(a){const e={id:r.id,name:r.name,singer:r.singer,ar:r.ar||(r.singer?r.singer.split("、").map(e=>({name:e})):[]),album:r.album||r.albumName,duration:r.dt||r.interval||r.duration,source:r.source||h.value,songmid:r.songmid,hash:r.hash,copyrightId:r.copyrightId,img:r.img||r.albumPic||(null==(o=r.al)?void 0:o.picUrl)||""},l=t.listStore.state.defaultList.list;console.log("[Sharelist] 试听列表当前歌曲数:",l.length);new Set(l.map(e=>e.id)).has(e.id)?console.log("[Sharelist] 歌曲已在试听列表中:",e.name):(t.listStore.addListMusics(t.LIST_IDS.DEFAULT,[e],"top"),console.log("[Sharelist] 已添加 1 首歌曲到试听列表:",e.name))}const u=null==(i=s.playerStore.state.currentSong)?void 0:i.id;console.log("[Sharelist] 之前播放的歌曲ID:",u,"即将播放的歌曲ID:",r.id);const c={id:r.id,name:r.name,singer:r.singer,ar:r.ar||(r.singer?r.singer.split("、").map(e=>({name:e})):[]),album:r.album||r.albumName,duration:r.dt||r.interval||r.duration,source:r.source||h.value,songmid:r.songmid,hash:r.hash,copyrightId:r.copyrightId,img:r.img||r.albumPic||(null==(n=r.al)?void 0:n.picUrl)||"",url:"",playUrl:"",lyric:"",tlyric:"",rlyric:"",lxlyric:""};t.listStore.setPlayMusicInfo(l,c,!1);const v=u===c.id;if(console.log("[Sharelist] 是否是同一首歌:",v,"previousSongId:",u,"currentId:",c.id),v)return console.log("[Sharelist] 同一首歌，切换播放/暂停状态"),void(s.playerStore.state.isPlaying?s.playerStore.pause():s.playerStore.resume());s.playerStore.updatePendingSong(null),console.log("[Sharelist] 调用 playerStore.playSong"),s.playerStore.playSong(c),console.log("[Sharelist] 播放完成")}catch(u){console.error("[Sharelist] 播放失败:",u),e.index.showToast({title:"播放失败: "+(u.message||"未知错误"),icon:"none"})}}},V=()=>{if(console.log("[Sharelist] loadMoreSongs 被触发"),console.log("[Sharelist] hasMore:",w.value,"isLoading:",D.value,"isPreviewMode:",v.value,"allSongs.length:",b.value.length),!w.value)return void console.log("[Sharelist] 没有更多数据，跳过加载");if(D.value)return void console.log("[Sharelist] 正在加载中，跳过");if(!v.value)return void console.log("[Sharelist] 非预览模式，跳过分页加载");console.log("[Sharelist] 开始加载更多歌曲...");const e=C.value+1,l=50*(e-1),a=50*e;console.log("[Sharelist] 加载第",e,"页, 范围:",l,"-",a);const o=b.value.slice(l,a);o.length>0?(M.value=[...M.value,...o],C.value=e,console.log("[Sharelist] 已加载",o.length,"首, 当前共",M.value.length,"首"),w.value=M.value.length<b.value.length,console.log("[Sharelist] 是否还有更多:",w.value)):(w.value=!1,console.log("[Sharelist] 没有更多歌曲了"))};e.onReachBottom(()=>{console.log("[Sharelist] onReachBottom 触发"),V()});const X=()=>{ee()},Y=e=>e&&Array.isArray(e)?e.map(e=>{var l,a;const o={id:e.id,name:e.name,singer:e.singer||(e.ar?e.ar.map(e=>e.name).join("/"):""),ar:e.ar||(e.singer?e.singer.split("、").map(e=>({name:e})):[]),album:e.album||e.albumName||(e.al?e.al.name:""),duration:e.duration||e.dt||e.interval,dt:e.dt||e.duration||e.interval,interval:e.interval||e.dt||e.duration,source:e.source};return e.songmid&&(o.songmid=e.songmid),e.hash&&(o.hash=e.hash),e.copyrightId&&(o.copyrightId=e.copyrightId),(e.img||e.albumPic||(null==(l=e.al)?void 0:l.picUrl))&&(o.img=e.img||e.albumPic||(null==(a=e.al)?void 0:a.picUrl)),o}):[],Z=async()=>{if(!I.value)return;const l=`${h.value}__${S.value}`;let a=e.index.getStorageSync("imported_playlists")||[];const o=a.findIndex(e=>e.sourceListId===l);-1===o?e.index.showModal({title:"导入歌单",content:`是否将「${I.value}」导入到我的歌单？`,confirmText:"导入",cancelText:"取消",success:async o=>{if(o.confirm){e.index.showLoading({title:"获取数据中..."});try{console.log("[Sharelist] 使用已加载的歌曲数据...");const o=b.value||[];if(console.log("[Sharelist] 已加载歌曲数量:",o.length,"首"),0===o.length)return e.index.showToast({title:"歌单为空，无法导入",icon:"none"}),void e.index.hideLoading();const s=l;console.log("[Sharelist] 导入歌单使用的ID:",s);const i=Y(o);console.log("[Sharelist] 精简后歌曲数量:",i.length,"首");const n={id:s,name:I.value,coverImgUrl:L.value,trackCount:o.length,source:h.value,sourceListId:l,link:r.value,platform:(t=h.value,{wy:"网易云音乐",tx:"QQ音乐",kg:"酷狗音乐",kw:"酷我音乐",mg:"咪咕音乐",local:"本地音乐"}[t]||t||"未知平台"),songs:i,canAutoUpdate:!0,isFromImport:"import"===m.value,autoUpdate:!1};a.push(n),e.index.setStorageSync("imported_playlists",a),e.index.showToast({title:`导入成功（${o.length}首）`,icon:"success"}),console.log("[Sharelist] handleCollect - fromPage.value:",m.value),"import"===m.value?setTimeout(()=>{e.index.showModal({title:"自动更新",content:`「${I.value}」导入成功！是否开启自动更新？`,confirmText:"开启",cancelText:"暂不开启",success:l=>{if(l.confirm){const l=e.index.getStorageSync("imported_playlists")||[],a=l.findIndex(e=>e.id===s);-1!==a&&(l[a].autoUpdate=!0,e.index.setStorageSync("imported_playlists",l),e.index.showToast({title:"已开启自动更新",icon:"success"}))}e.index.navigateBack()}})},1500):setTimeout(()=>{e.index.navigateBack()},1500)}catch(s){console.error("导入失败:",s),e.index.showToast({title:"导入失败",icon:"none"})}finally{e.index.hideLoading()}}var t}}):e.index.showModal({title:"提示",content:`歌单「${a[o].name}」已存在，是否同步更新？`,confirmText:"更新",cancelText:"取消",success:async l=>{if(l.confirm){e.index.showLoading({title:"更新中..."});try{console.log("[Sharelist] 使用已加载的歌曲数据更新...");const l=b.value||[],t=Y(l);a[o].songs=t,a[o].trackCount=l.length,a[o].coverImgUrl=L.value,e.index.setStorageSync("imported_playlists",a),e.index.showToast({title:"更新成功",icon:"success"})}catch(t){console.error("[Sharelist] 更新失败:",t),e.index.showToast({title:"更新失败",icon:"none"})}finally{e.index.hideLoading()}}}})},ee=async()=>{var l,t,s,i,n,c,v,m,p,f,C,k;if(console.log("[Sharelist] loadPreviewList 开始执行"),D.value)console.log("[Sharelist] 正在加载中，跳过");else{D.value=!0,d.value="";try{let g;const D=getCurrentPages(),E=D[D.length-1],N=(null==(l=E.$page)?void 0:l.options)||E.options||{};let R=N.id;if(!R&&r.value){let l=decodeURIComponent(r.value);if(/^https?:\/\//.test(l)){let a=l.match(/[?&]id=(\d+)/);if(a)R=a[1],console.log("[Sharelist] 从URL查询参数解析出ID:",R);else if(a=l.match(/\/playlist(?:_detail)?\/(\d+)/),a)R=a[1],console.log("[Sharelist] 从URL路径解析出ID:",R);else if("mg"===u.value&&l.includes("c.migu.cn")){console.log("[Sharelist] 检测到咪咕短链接，尝试获取真实URL...");try{const a=await e.index.request({url:l,method:"HEAD",header:{"User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15"}}),o=(null==(t=a.header)?void 0:t.Location)||(null==(s=a.header)?void 0:s.location);if(o){console.log("[Sharelist] 咪咕短链接重定向到:",o);const e=o.match(/[?&]id=(\d+)/);e&&(R=e[1],console.log("[Sharelist] 从咪咕重定向URL解析出ID:",R))}}catch(A){console.error("[Sharelist] 获取咪咕短链接失败:",A)}}}else R=l,console.log("[Sharelist] 直接使用作为ID:",R)}"tx"===u.value?(console.log("[Sharelist] QQ音乐使用后端接口:",u.value),console.log("[Sharelist] 调用 getListDetail:",u.value,r.value),g=await a.getListDetail(u.value,r.value,U.value)):(console.log("[Sharelist] 使用前端直接API:",u.value),console.log("[Sharelist] 调用 getListDetailDirect:",u.value,R),g=await o.getListDetailDirect(u.value,R,1)),console.log("[Sharelist] ========== 返回数据开始 =========="),console.log("[Sharelist] result.info:",JSON.stringify(g.info)),console.log("[Sharelist] result.list类型:",typeof g.list,"是否是数组:",Array.isArray(g.list)),console.log("[Sharelist] result.list长度:",null==(i=g.list)?void 0:i.length),console.log("[Sharelist] result.list前3项:",JSON.stringify(null==(n=g.list)?void 0:n.slice(0,3))),console.log("[Sharelist] ========== 返回数据结束 =========="),h.value=g.source,S.value=g.id||N.id||"",console.log("[Sharelist] 开始更新歌单信息..."),y.value=g.id||N.id||"",I.value=(null==(c=g.info)?void 0:c.name)||"未知歌单",L.value=(null==(v=g.info)?void 0:v.img)||"",x.value=(null==(m=g.info)?void 0:m.author)||"",T.value=(null==(p=g.info)?void 0:p.desc)||"",P.value=g.total||0,_.value=(null==(f=g.info)?void 0:f.play_count)||"",console.log("[Sharelist] 歌单信息已更新:",{name:I.value,author:x.value,playCount:_.value,trackCount:P.value}),console.log("[Sharelist] 开始更新歌曲列表..."),b.value=g.list||[],console.log("[Sharelist] 总歌曲数量:",null==(C=b.value)?void 0:C.length),console.log("[Sharelist] result.total:",g.total),console.log("[Sharelist] result.limit:",g.limit),E.value=1;const $=0,j=Math.min(50,b.value.length);M.value=b.value.slice($,j),console.log("[Sharelist] 当前显示:",null==(k=M.value)?void 0:k.length,"首"),console.log("[Sharelist] 第1页范围:",$,"-",j),w.value=b.value.length>M.value.length,console.log("[Sharelist] 是否还有更多:",w.value),0===b.value.length&&(console.log("[Sharelist] 歌单为空，可能原因："),console.log("[Sharelist] 1. 歌单ID无效或歌单不存在"),console.log("[Sharelist] 2. 歌单是私有的"),console.log("[Sharelist] 3. 歌单已被删除"),console.log("[Sharelist] 4. 网络请求失败"),d.value="歌单为空，可能原因：\n1. 歌单不存在或已被删除\n2. 歌单是私有的\n3. 网络请求失败\n\n请尝试其他歌单")}catch(E){console.error("[Sharelist] 加载歌单失败:",E),d.value=E.message||"加载失败，请检查链接是否正确",e.index.showToast({title:d.value,icon:"none",duration:3e3})}finally{D.value=!1,g.value=!0,console.log("[Sharelist] loadPreviewList 执行完成, isLoading:",D.value,"songs.length:",M.value.length),setTimeout(()=>{console.log("[Sharelist] 强制刷新后的 songs.length:",M.value.length)},100)}}};return e.onMounted(()=>{var l;console.log("[Sharelist] onMounted 开始执行"),R(),e.index.$on("miniPlayerHeightChange",j);const a=getCurrentPages(),o=a[a.length-1],i=(null==(l=o.$page)?void 0:l.options)||o.options||{};if(console.log("[Sharelist] 页面参数:",JSON.stringify(i)),console.log("[Sharelist] link:",i.link),console.log("[Sharelist] source:",i.source),console.log("[Sharelist] platform:",i.platform),console.log("[Sharelist] id:",i.id),console.log("[Sharelist] fromName:",i.fromName),console.log("[Sharelist] from:",i.from),m.value=i.from||"",console.log("[Sharelist] fromPage.value:",m.value),"true"===i.fromMyMusic&&i.playlistId)return console.log("[Sharelist] 从我的音乐页面进入，尝试加载本地数据"),console.log("[Sharelist] playlistId:",i.playlistId),D.value=!0,void setTimeout(()=>{if(i.playlistId&&i.playlistId.startsWith("userlist_")){console.log("[Sharelist] 用户自建歌单模式"),B.value=!0;const e=(t.listStore.state.userLists||[]).find(e=>e.id===i.playlistId);if(console.log("[Sharelist] 查找到的用户歌单:",e?e.name:"未找到"),e&&e.list&&e.list.length>0){console.log("[Sharelist] 使用用户自建歌单数据，数量:",e.list.length);const l=e.list.map(e=>({...e,ar:e.ar||(e.singer?e.singer.split("、").map(e=>({name:e})):[])})),a=i.playlistName?decodeURIComponent(i.playlistName):"";I.value=a||e.name||"未知歌单",L.value=e.coverImgUrl||"/static/logo.png",x.value=e.author||"",T.value=e.desc||"",P.value=e.list.length,_.value="",M.value=l,b.value=l,w.value=!1,D.value=!1,v.value=!1,g.value=!0,O.value=e.id,h.value="local",console.log("[Sharelist] 用户自建歌单数据加载完成")}else console.log("[Sharelist] 用户自建歌单未找到数据"),D.value=!1,d.value="歌单数据不存在"}else{console.log("[Sharelist] 导入歌单模式"),B.value=!0;let a=[];try{const l=e.index.getStorageSync("imported_playlists");l&&("string"==typeof l?a=JSON.parse(l):Array.isArray(l)&&(a=l))}catch(l){console.error("[Sharelist] 解析导入歌单失败:",l)}const o=a.find(e=>e.id===i.playlistId||e.sourceListId===i.playlistId);if(console.log("[Sharelist] 查找到的导入歌单:",o?o.name:"未找到"),o&&o.songs&&o.songs.length>0){console.log("[Sharelist] 使用导入歌单数据，数量:",o.songs.length);const e=o.songs.map(e=>({...e,ar:e.ar||(e.singer?e.singer.split("、").map(e=>({name:e})):[])}));I.value=o.name||"未知歌单",L.value=o.coverImgUrl||"/static/logo.png",x.value=o.author||"",T.value=o.desc||"",P.value=o.songs.length,_.value=o.playCount?z(o.playCount):"",M.value=e,b.value=e,w.value=!1,D.value=!1,v.value=!1,g.value=!0,O.value=o.id||o.sourceListId,h.value=o.platform||i.source||"",console.log("[Sharelist] 导入歌单数据加载完成")}else console.log("[Sharelist] 导入歌单未找到数据"),D.value=!1,d.value="歌单数据不存在"}},100);i.link&&i.source?(console.log("[Sharelist] 进入预览模式"),v.value=!0,r.value=decodeURIComponent(i.link),u.value=i.source,c.value=decodeURIComponent(i.platform||""),console.log("[Sharelist] pageLink:",r.value),console.log("[Sharelist] pageSource:",u.value),console.log("[Sharelist] pagePlatform:",c.value),i.name&&(I.value=decodeURIComponent(i.name)),i.picUrl&&(L.value=decodeURIComponent(i.picUrl)),i.author&&(x.value=decodeURIComponent(i.author)),i.playCount&&(_.value=z(i.playCount)),i.id&&(y.value=i.id),ee()):"user"===i.mode&&"true"===i.fromMyMusic?(console.log("[Sharelist] 进入用户自建歌单模式"),console.log("[Sharelist] playlistId:",i.playlistId),v.value=!1,g.value=!0,D.value=!0,setTimeout(()=>{const e=(t.listStore.state.userLists||[]).find(e=>e.id===i.playlistId);if(console.log("[Sharelist] 查找到的歌单:",e?e.name:"未找到"),e&&e.list&&e.list.length>0){M.value=e.list,b.value=e.list;const l=i.playlistName?decodeURIComponent(i.playlistName):"";I.value=l||e.name||"未知歌单",L.value=e.coverImgUrl||"/static/logo.png",P.value=e.list.length,w.value=!1,D.value=!1,O.value=e.id}else D.value=!1,d.value="歌单暂无歌曲"},100)):"love"===i.mode&&"true"===i.fromMyMusic?(console.log("[Sharelist] 进入我喜欢的音乐模式"),v.value=!1,g.value=!0,D.value=!0,setTimeout(()=>{const e=t.listStore.state.loveList.list||[];console.log("[Sharelist] 喜欢列表数量:",e.length),e.length>0?(M.value=e,b.value=e,I.value="我喜欢的音乐",L.value="/static/logo.png",P.value=e.length,w.value=!1,D.value=!1,O.value=t.LIST_IDS.LOVE):(D.value=!1,d.value="暂无喜欢的音乐")},100)):"recent"===i.mode&&"true"===i.fromMyMusic?(console.log("[Sharelist] 进入最近播放模式"),v.value=!1,g.value=!1,D.value=!0,setTimeout(()=>{const e=s.playerStore.getState().playHistory||[];console.log("[Sharelist] 播放历史数量:",e.length),e.length>0?(M.value=e,I.value="最近播放",L.value="/static/logo.png",P.value=e.length,w.value=!1,D.value=!1,O.value="recent_play_history"):(D.value=!1,d.value="暂无播放记录")},100)):"deleted"===i.mode&&"true"===i.fromMyMusic?(console.log("[Sharelist] 进入最近删除模式"),v.value=!1,g.value=!1,D.value=!0,setTimeout(()=>{let l=[];try{const a=e.index.getStorageSync("deleted_songs");a&&("string"==typeof a?l=JSON.parse(a):Array.isArray(a)?l=a:a.data&&Array.isArray(a.data)&&(l=a.data))}catch(a){console.error("[Sharelist] 解析删除列表失败:",a)}console.log("[Sharelist] 删除列表数量:",l.length),l.length>0?(M.value=l,I.value="最近删除",L.value="/static/logo.png",P.value=l.length,w.value=!1,D.value=!1,O.value="recent_deleted"):(D.value=!1,d.value="暂无删除记录")},100)):(console.log("[Sharelist] 缺少必要参数，无法加载"),d.value="缺少必要参数：link或source")}),e.onShow(()=>{l.setStatusBarTextColor("white"),R()}),e.onUnmounted(()=>{e.index.$off("miniPlayerHeightChange",j)}),(l,o)=>e.e({a:e.unref(i.proxyImageUrl)(L.value),b:e.o(e=>W(e)),c:e.s(f.value),d:e.p({name:"chevron-left",size:"24",color:"#fff"}),e:e.o(F),f:e.t(v.value?"歌单预览":"歌单详情"),g:e.unref(i.proxyImageUrl)(L.value),h:e.o(e=>W(e)),i:_.value},_.value?{j:e.p({name:"play",size:"10",color:"#fff"}),k:e.t(_.value)}:{},{l:e.t(I.value||"加载中..."),m:x.value},x.value?{n:e.t(x.value)}:{},{o:T.value},T.value?{p:e.t(T.value)}:{},{q:e.t(P.value),r:_.value},(_.value,{}),{s:_.value},_.value?{t:e.t(_.value)}:{},{v:g.value},g.value?e.e({w:v.value},v.value?{x:e.p({name:"heart",size:"14",color:"#fff"}),y:e.t("import"===m.value?"导入歌单":"收藏歌单"),z:e.o(Z)}:{},{A:e.p({name:"play",size:"14",color:"#fff"}),B:e.o(K)}):{},{C:D.value&&0===M.value.length},(D.value&&M.value.length,{}),{D:d.value&&!D.value},d.value&&!D.value?{E:e.p({name:"exclamation-circle",size:"48",color:"#999"}),F:e.t(d.value),G:e.o(X)}:{},{H:M.value.length>0},M.value.length>0?e.e({I:e.f(M.value,(l,o,t)=>{var i,n,r,u;return e.e({a:e.t(o+1),b:e.t(l.name),c:J(l)},(J(l),{}),{d:e.t(H(l.ar||l.singer)),e:(null==(i=l.al)?void 0:i.name)||l.album||l.albumName},(null==(n=l.al)?void 0:n.name)||l.album||l.albumName?{f:e.t((null==(r=l.al)?void 0:r.name)||l.album||l.albumName)}:{},{g:k.value===o&&A.value},k.value===o&&A.value?{h:"864f0795-5-"+t,i:e.p({name:"play",size:"18"})}:k.value!==o||A.value?{}:{k:"864f0795-6-"+t,l:e.p({name:"pause",size:"18"})},{j:k.value===o&&!A.value,m:e.t((u=l.dt||l.interval||l.duration,a.formatDuration(u))),n:l.id||o,o:k.value===o?1:"",p:e.o(e=>(e=>{k.value!==e?G(e):A.value?s.playerStore.pause():s.playerStore.resume()})(o),l.id||o)})}),J:D.value&&M.value.length>0},(D.value&&M.value.length,{}),{K:!w.value&&M.value.length>0&&!D.value},(!w.value&&M.value.length>0&&D.value,{}),{L:$.value+"px"}):{},{M:!D.value&&!d.value&&0===M.value.length},D.value||d.value||0!==M.value.length?{}:{N:e.p({name:"ban",size:"64",color:"#ccc"})},{O:q.value,P:e.o(V),Q:!v.value},v.value?{}:{R:e.p({"current-index":2})},{S:N.value?1:""})}},c=e._export_sfc(u,[["__scopeId","data-v-864f0795"]]);wx.createPage(c);
