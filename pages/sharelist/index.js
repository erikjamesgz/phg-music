"use strict";const e=require("../../common/vendor.js"),l=require("../../utils/system.js"),a=require("../../utils/api/songlist.js"),o=require("../../utils/api/songlist-direct.js"),t=require("../../store/modules/list.js"),s=require("../../store/modules/player.js"),i=require("../../store/modules/system.js"),n=require("../../utils/api/music.js"),r=require("../../utils/musicUrlCache.js"),u=require("../../utils/lyricCache.js"),c=require("../../utils/imageProxy.js");if(!Array){e.resolveComponent("custom-tabbar")()}Math||(v+g)();const v=()=>"../../uni_modules/roc-icon-plus/components/roc-icon-plus/roc-icon-plus.js",g=()=>"../../components/player/MiniPlayer.js",d={__name:"index",setup(v){const g=e.ref(""),d=e.ref(""),h=e.ref(""),m=e.ref(!1),S=e.ref(!1),y=e.ref(""),p=e.ref(""),f=e.ref(""),I=e.ref(""),x=e.ref(l.getStatusBarHeight()),L=e.computed(()=>({height:`${x.value}px`,width:"100%"})),w=e.ref(""),b=e.ref(""),U=e.ref(""),T=e.ref(""),P=e.ref(""),M=e.ref(0),C=e.ref(""),k=e.ref([]),_=e.ref(!1),D=e.ref(!0),N=e.ref(1),A=e.ref([]),q=e.ref(1),R=e.computed(()=>{var e;$.value;const l=t.listStore.state.playInfo.playerListId,a=t.listStore.state.tempList.meta,o=t.listStore.state.playInfo.playIndex;console.log("[Sharelist] currentSongIndex 计算:",{playerListId:l,tempListMetaId:null==a?void 0:a.id,currentListId:H.value,playIndex:o,songsLength:k.value.length});const i=null==(e=s.playerStore.state.currentSong)?void 0:e.id;if(console.log("[Sharelist] 当前播放歌曲ID:",i),l===t.LIST_IDS.TEMP)return(null==a?void 0:a.id)===H.value&&o>=0&&o<k.value.length?o:(console.log("[Sharelist] 临时列表不匹配当前列表，返回 -1"),-1);if(l===t.LIST_IDS.DEFAULT&&i){const e=k.value.findIndex(e=>e.id===i);return console.log("[Sharelist] 在songs中查找索引:",i,"结果:",e),e}return console.log("[Sharelist] 不在播放当前列表，返回 -1"),-1});e.computed(()=>R.value>=0&&k.value.length>R.value?k.value[R.value]:null);const j=e.computed(()=>s.playerStore.state.isPlaying),$=e.ref(0);e.watch(()=>s.playerStore.state.currentSong,(e,l)=>{console.log("[Sharelist] playerStore.currentSong 变化:",null==e?void 0:e.name,"ID:",null==e?void 0:e.id),$.value++},{deep:!0}),e.watch(()=>[t.listStore.state.playInfo.playerListId,t.listStore.state.playInfo.playIndex],(e,l)=>{console.log("[Sharelist] playInfo 变化:",e),$.value++},{deep:!0});const E=e.ref(!1),O=()=>{E.value="true"===e.index.getStorageSync("darkMode"),console.log("[Sharelist] 初始化暗黑模式:",E.value)},z=e.ref(0),J=({height:e,isShowing:l})=>{console.log("[Sharelist] MiniPlayer 高度变化:",e,"是否显示:",l),z.value=l?e:0},B=e.ref(0),Q=e=>e?a.formatPlayCount(e):"0",H=e.ref(""),F=()=>(H.value||(H.value=`${p.value}_${Date.now()}`),H.value),K=e=>a.formatDuration(e),G=e=>e.types?e.types.some(e=>"flac"===e.type||"flac24bit"===e.type||"SQ"===e.type):"SQ"===e.quality,V=()=>{e.index.navigateBack()},W=(e,l)=>{if(!U.value)return;let a=0;U.value.includes("wsrv.nl")?a=1:U.value.includes("weserv.nl")?a=2:U.value.includes("jina.ai")&&(a=3);const o=c.handleImageError(e,U.value,a);o&&(U.value=o)},X=async()=>{if(0===k.value.length)return;console.log("[Sharelist] 播放全部，使用临时列表播放");const e=F();t.listStore.setTempList(e,k.value,{id:e,source:p.value,name:b.value}),t.listStore.setPlayerListId(t.LIST_IDS.TEMP),await Y(0,!1)},Y=async(l,a=!0)=>{var o,c,v;const g=k.value[l];if(g){console.log("[Sharelist] ========== 播放歌曲开始 =========="),console.log("[Sharelist] 歌曲索引:",l),console.log("[Sharelist] 是否添加到试听列表:",a);try{const e=i.systemStore.getState().audioQuality||"128k";console.log(`[Sharelist] 使用音质 ${e} 获取歌曲播放URL`);const l=a?t.LIST_IDS.DEFAULT:t.LIST_IDS.TEMP;if(a){const e={id:g.id,name:g.name,singer:g.singer,album:g.album||g.albumName,duration:g.dt||g.interval||g.duration,source:g.source||p.value,songmid:g.songmid,hash:g.hash,copyrightId:g.copyrightId,img:g.img||g.albumPic||(null==(o=g.al)?void 0:o.picUrl)||""},l=t.listStore.state.defaultList.list;console.log("[Sharelist] 试听列表当前歌曲数:",l.length);new Set(l.map(e=>e.id)).has(e.id)?console.log("[Sharelist] 歌曲已在试听列表中:",e.name):(t.listStore.addListMusics(t.LIST_IDS.DEFAULT,[e],"top"),console.log("[Sharelist] 已添加 1 首歌曲到试听列表:",e.name))}t.listStore.setPlayerListId(l);const h=null==(c=s.playerStore.state.currentSong)?void 0:c.id;console.log("[Sharelist] 之前播放的歌曲ID:",h,"即将播放的歌曲ID:",g.id);const m={id:g.id,name:g.name,singer:g.singer,album:g.album||g.albumName,duration:g.dt||g.interval||g.duration,source:g.source||p.value,songmid:g.songmid,hash:g.hash,copyrightId:g.copyrightId,img:g.img||g.albumPic||(null==(v=g.al)?void 0:v.picUrl)||"",url:"",playUrl:"",quality:e,lyric:"",tlyric:"",rlyric:"",lxlyric:""};t.listStore.setPlayMusicInfo(l,m,!1),s.playerStore.setCurrentSong(m,!0),s.playerStore.setStatusText("正在获取播放链接...",0),console.log("[Sharelist] 已设置歌曲信息，MiniPlayer 将显示");const S=await r.getCachedMusicUrl(g.id,e);let y=S,f=null;if(S){console.log("[Sharelist] 使用缓存的播放URL:",S);const e=g.source||p.value||"tx",l=await u.getCachedLyric(g.id,e);l?(f=l,console.log("[Sharelist] 从缓存获取歌词:",g.id)):(f={},console.log("[Sharelist] 歌词缓存未命中:",g.id))}else{let l;console.log("[Sharelist] 没有缓存，调用API获取播放URL");const a=g.source||p.value||"tx";switch(console.log("[Sharelist] 音源:",a),a){case"tx":l={source:"tx",musicInfo:{id:g.songmid||g.id,name:g.name,singer:g.singer||"",source:"tx",songmid:g.songmid||g.id,interval:K(g.dt||g.interval||g.duration),meta:{songId:g.songmid||g.id,albumName:g.album||g.albumName||"",hash:g.songmid||g.id}},quality:e};break;case"wy":l={source:"wy",musicInfo:{id:g.id,name:g.name,singer:g.singer||"",source:"wy",interval:K(g.dt||g.interval||g.duration),meta:{songId:g.id,albumName:g.album||g.albumName||"",hash:g.id}},quality:e};break;case"kg":l={source:"kg",musicInfo:{id:g.id,name:g.name,singer:g.singer||"",source:"kg",interval:K(g.dt||g.interval||g.duration),meta:{songId:g.id,albumName:g.album||g.albumName||"",hash:g.hash||g.id}},quality:e};break;case"kw":l={source:"kw",musicInfo:{id:g.id,name:g.name,singer:g.singer||"",source:"kw",interval:K(g.dt||g.interval||g.duration),meta:{songId:g.id,albumName:g.album||g.albumName||"",hash:g.id}},quality:e};break;case"mg":const o=g.songmid||g.songId,t=g.copyrightId||g.id;l={source:"mg",songmid:o,id:t,musicInfo:{songmid:o,copyrightId:t,name:g.name,singer:g.singer||"",album:g.album||g.albumName||""},quality:e};break;default:l={source:a,musicInfo:{id:g.id,name:g.name,singer:g.singer||"",source:a,interval:K(g.dt||g.interval||g.duration),meta:{songId:g.id,albumName:g.album||g.albumName||"",hash:g.id}},quality:e}}let o;console.log("[Sharelist] 请求参数:",JSON.stringify(l));try{o=await n.getMusicUrl(l),console.log("[Sharelist] API返回数据:",JSON.stringify(o))}catch(d){throw console.error("[Sharelist] API调用失败:",d),new Error("获取播放链接失败: "+(d.message||"网络请求失败"))}if(y=null==o?void 0:o.url,!y)throw console.error("[Sharelist] API返回数据中没有URL:",JSON.stringify(o)),new Error("无法获取播放链接，该歌曲可能不可用");console.log("[Sharelist] 获取到的播放URL:",y),await r.setCachedMusicUrl(g.id,e,y),f={lyric:o.lyric||"",tlyric:o.tlyric||"",rlyric:o.rlyric||"",lxlyric:o.lxlyric||""},(f.lyric||f.tlyric||f.rlyric||f.lxlyric)&&(await u.setCachedLyric(g.id,a,f),console.log("[Sharelist] 歌词已缓存:",g.id))}const I={...m,url:y,playUrl:y,lyric:(null==f?void 0:f.lyric)||"",tlyric:(null==f?void 0:f.tlyric)||"",rlyric:(null==f?void 0:f.rlyric)||"",lxlyric:(null==f?void 0:f.lxlyric)||""};console.log("[Sharelist] 最终歌曲信息:",I.name,"URL:",y?"有":"无"),t.listStore.setPlayMusicInfo(l,I,!1);const x=h===I.id;if(console.log("[Sharelist] 是否是同一首歌:",x,"previousSongId:",h,"currentId:",I.id),x)return console.log("[Sharelist] 同一首歌，切换播放/暂停状态"),s.playerStore.clearStatusText(),void(s.playerStore.state.isPlaying?s.playerStore.pause():s.playerStore.resume());s.playerStore.playSong(I),console.log("[Sharelist] 播放完成")}catch(h){console.error("[Sharelist] 播放失败:",h),e.index.showToast({title:"播放失败: "+(h.message||"未知错误"),icon:"none"})}}},Z=()=>{if(console.log("[Sharelist] loadMoreSongs 被触发"),console.log("[Sharelist] hasMore:",D.value,"isLoading:",_.value,"isPreviewMode:",m.value,"allSongs.length:",A.value.length),!D.value)return void console.log("[Sharelist] 没有更多数据，跳过加载");if(_.value)return void console.log("[Sharelist] 正在加载中，跳过");if(!m.value)return void console.log("[Sharelist] 非预览模式，跳过分页加载");console.log("[Sharelist] 开始加载更多歌曲...");const e=q.value+1,l=50*(e-1),a=50*e;console.log("[Sharelist] 加载第",e,"页, 范围:",l,"-",a);const o=A.value.slice(l,a);o.length>0?(k.value=[...k.value,...o],q.value=e,console.log("[Sharelist] 已加载",o.length,"首, 当前共",k.value.length,"首"),D.value=k.value.length<A.value.length,console.log("[Sharelist] 是否还有更多:",D.value)):(D.value=!1,console.log("[Sharelist] 没有更多歌曲了"))};e.onReachBottom(()=>{console.log("[Sharelist] onReachBottom 触发"),Z()});const ee=()=>{oe()},le=e=>e&&Array.isArray(e)?e.map(e=>{var l,a;const o={id:e.id,name:e.name,singer:e.singer||(e.ar?e.ar.map(e=>e.name).join("/"):""),album:e.album||e.albumName||(e.al?e.al.name:""),duration:e.duration||e.dt||e.interval,dt:e.dt||e.duration||e.interval,interval:e.interval||e.dt||e.duration,source:e.source};return e.songmid&&(o.songmid=e.songmid),e.hash&&(o.hash=e.hash),e.copyrightId&&(o.copyrightId=e.copyrightId),(e.img||e.albumPic||(null==(l=e.al)?void 0:l.picUrl))&&(o.img=e.img||e.albumPic||(null==(a=e.al)?void 0:a.picUrl)),o}):[],ae=async()=>{if(!b.value)return;const l=`${p.value}__${f.value}`;let a=e.index.getStorageSync("imported_playlists")||[];const o=a.findIndex(e=>e.sourceListId===l);-1===o?e.index.showModal({title:"导入歌单",content:`是否将「${b.value}」导入到我的歌单？`,confirmText:"导入",cancelText:"取消",success:async o=>{if(o.confirm){e.index.showLoading({title:"获取数据中..."});try{console.log("[Sharelist] 使用已加载的歌曲数据...");const o=A.value||[];if(console.log("[Sharelist] 已加载歌曲数量:",o.length,"首"),0===o.length)return e.index.showToast({title:"歌单为空，无法导入",icon:"none"}),void e.index.hideLoading();const s=l;console.log("[Sharelist] 导入歌单使用的ID:",s);const i=le(o);console.log("[Sharelist] 精简后歌曲数量:",i.length,"首");const n={id:s,name:b.value,coverImgUrl:U.value,trackCount:o.length,source:p.value,sourceListId:l,link:g.value,platform:(t=p.value,{wy:"网易云音乐",tx:"QQ音乐",kg:"酷狗音乐",kw:"酷我音乐",mg:"咪咕音乐",local:"本地音乐"}[t]||t||"未知平台"),songs:i,canAutoUpdate:!0,isFromImport:"import"===I.value,autoUpdate:!1};a.push(n),e.index.setStorageSync("imported_playlists",a),e.index.showToast({title:`导入成功（${o.length}首）`,icon:"success"}),console.log("[Sharelist] handleCollect - fromPage.value:",I.value),"import"===I.value?setTimeout(()=>{e.index.showModal({title:"自动更新",content:`「${b.value}」导入成功！是否开启自动更新？`,confirmText:"开启",cancelText:"暂不开启",success:l=>{if(l.confirm){const l=e.index.getStorageSync("imported_playlists")||[],a=l.findIndex(e=>e.id===s);-1!==a&&(l[a].autoUpdate=!0,e.index.setStorageSync("imported_playlists",l),e.index.showToast({title:"已开启自动更新",icon:"success"}))}e.index.navigateBack()}})},1500):setTimeout(()=>{e.index.navigateBack()},1500)}catch(s){console.error("导入失败:",s),e.index.showToast({title:"导入失败",icon:"none"})}finally{e.index.hideLoading()}}var t}}):e.index.showModal({title:"提示",content:`歌单「${a[o].name}」已存在，是否同步更新？`,confirmText:"更新",cancelText:"取消",success:async l=>{if(l.confirm){e.index.showLoading({title:"更新中..."});try{console.log("[Sharelist] 使用已加载的歌曲数据更新...");const l=A.value||[],t=le(l);a[o].songs=t,a[o].trackCount=l.length,a[o].coverImgUrl=U.value,e.index.setStorageSync("imported_playlists",a),e.index.showToast({title:"更新成功",icon:"success"})}catch(t){console.error("[Sharelist] 更新失败:",t),e.index.showToast({title:"更新失败",icon:"none"})}finally{e.index.hideLoading()}}}})},oe=async()=>{var l,t,s,i,n,r,u,c,v,h,m,I;if(console.log("[Sharelist] loadPreviewList 开始执行"),_.value)console.log("[Sharelist] 正在加载中，跳过");else{_.value=!0,y.value="";try{let S;const L=getCurrentPages(),_=L[L.length-1],q=(null==(l=_.$page)?void 0:l.options)||_.options||{};let R=q.id;if(!R&&g.value){let l=decodeURIComponent(g.value);if(/^https?:\/\//.test(l)){let a=l.match(/[?&]id=(\d+)/);if(a)R=a[1],console.log("[Sharelist] 从URL查询参数解析出ID:",R);else if(a=l.match(/\/playlist(?:_detail)?\/(\d+)/),a)R=a[1],console.log("[Sharelist] 从URL路径解析出ID:",R);else if("mg"===d.value&&l.includes("c.migu.cn")){console.log("[Sharelist] 检测到咪咕短链接，尝试获取真实URL...");try{const a=await e.index.request({url:l,method:"HEAD",header:{"User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15"}}),o=(null==(t=a.header)?void 0:t.Location)||(null==(s=a.header)?void 0:s.location);if(o){console.log("[Sharelist] 咪咕短链接重定向到:",o);const e=o.match(/[?&]id=(\d+)/);e&&(R=e[1],console.log("[Sharelist] 从咪咕重定向URL解析出ID:",R))}}catch(x){console.error("[Sharelist] 获取咪咕短链接失败:",x)}}}else R=l,console.log("[Sharelist] 直接使用作为ID:",R)}"tx"===d.value?(console.log("[Sharelist] QQ音乐使用后端接口:",d.value),console.log("[Sharelist] 调用 getListDetail:",d.value,g.value),S=await a.getListDetail(d.value,g.value,N.value)):(console.log("[Sharelist] 使用前端直接API:",d.value),console.log("[Sharelist] 调用 getListDetailDirect:",d.value,R),S=await o.getListDetailDirect(d.value,R,1)),console.log("[Sharelist] ========== 返回数据开始 =========="),console.log("[Sharelist] result.info:",JSON.stringify(S.info)),console.log("[Sharelist] result.list类型:",typeof S.list,"是否是数组:",Array.isArray(S.list)),console.log("[Sharelist] result.list长度:",null==(i=S.list)?void 0:i.length),console.log("[Sharelist] result.list前3项:",JSON.stringify(null==(n=S.list)?void 0:n.slice(0,3))),console.log("[Sharelist] ========== 返回数据结束 =========="),p.value=S.source,f.value=S.id||q.id||"",console.log("[Sharelist] 开始更新歌单信息..."),w.value=S.id||q.id||"",b.value=(null==(r=S.info)?void 0:r.name)||"未知歌单",U.value=(null==(u=S.info)?void 0:u.img)||"",T.value=(null==(c=S.info)?void 0:c.author)||"",P.value=(null==(v=S.info)?void 0:v.desc)||"",M.value=S.total||0,C.value=(null==(h=S.info)?void 0:h.play_count)||"",console.log("[Sharelist] 歌单信息已更新:",{name:b.value,author:T.value,playCount:C.value,trackCount:M.value}),console.log("[Sharelist] 开始更新歌曲列表..."),A.value=S.list||[],console.log("[Sharelist] 总歌曲数量:",null==(m=A.value)?void 0:m.length),console.log("[Sharelist] result.total:",S.total),console.log("[Sharelist] result.limit:",S.limit),_.value=1;const j=0,$=Math.min(50,A.value.length);k.value=A.value.slice(j,$),console.log("[Sharelist] 当前显示:",null==(I=k.value)?void 0:I.length,"首"),console.log("[Sharelist] 第1页范围:",j,"-",$),D.value=A.value.length>k.value.length,console.log("[Sharelist] 是否还有更多:",D.value),0===A.value.length&&(console.log("[Sharelist] 歌单为空，可能原因："),console.log("[Sharelist] 1. 歌单ID无效或歌单不存在"),console.log("[Sharelist] 2. 歌单是私有的"),console.log("[Sharelist] 3. 歌单已被删除"),console.log("[Sharelist] 4. 网络请求失败"),y.value="歌单为空，可能原因：\n1. 歌单不存在或已被删除\n2. 歌单是私有的\n3. 网络请求失败\n\n请尝试其他歌单")}catch(L){console.error("[Sharelist] 加载歌单失败:",L),y.value=L.message||"加载失败，请检查链接是否正确",e.index.showToast({title:y.value,icon:"none",duration:3e3})}finally{_.value=!1,S.value=!0,console.log("[Sharelist] loadPreviewList 执行完成, isLoading:",_.value,"songs.length:",k.value.length),setTimeout(()=>{console.log("[Sharelist] 强制刷新后的 songs.length:",k.value.length)},100)}}};return e.onMounted(()=>{var l;console.log("[Sharelist] onMounted 开始执行"),O(),e.index.$on("miniPlayerHeightChange",J);const a=getCurrentPages(),o=a[a.length-1],i=(null==(l=o.$page)?void 0:l.options)||o.options||{};if(console.log("[Sharelist] 页面参数:",JSON.stringify(i)),console.log("[Sharelist] link:",i.link),console.log("[Sharelist] source:",i.source),console.log("[Sharelist] platform:",i.platform),console.log("[Sharelist] id:",i.id),console.log("[Sharelist] fromName:",i.fromName),console.log("[Sharelist] from:",i.from),I.value=i.from||"",console.log("[Sharelist] fromPage.value:",I.value),"true"===i.fromMyMusic&&i.playlistId)return console.log("[Sharelist] 从我的音乐页面进入，尝试加载本地数据"),console.log("[Sharelist] playlistId:",i.playlistId),_.value=!0,void setTimeout(()=>{let l=[];try{const a=e.index.getStorageSync("imported_playlists");a&&("string"==typeof a?l=JSON.parse(a):Array.isArray(a)&&(l=a))}catch(o){console.error("[Sharelist] 解析导入歌单失败:",o)}const a=l.find(e=>e.id===i.playlistId||e.sourceListId===i.playlistId);console.log("[Sharelist] 查找到的歌单:",a?a.name:"未找到"),a&&a.songs&&a.songs.length>0?(console.log("[Sharelist] 使用本地保存的歌曲数据，数量:",a.songs.length),b.value=a.name||"未知歌单",U.value=a.coverImgUrl||"/static/logo.png",T.value=a.author||"",P.value=a.desc||"",M.value=a.songs.length,C.value=a.playCount?Q(a.playCount):"",k.value=a.songs,A.value=a.songs,D.value=!1,_.value=!1,m.value=!1,S.value=!0,H.value=a.id||a.sourceListId,p.value=a.platform||i.source||"",console.log("[Sharelist] 本地数据加载完成")):(console.log("[Sharelist] 本地未找到歌单数据"),_.value=!1,y.value="歌单数据不存在")},100);i.link&&i.source?(console.log("[Sharelist] 进入预览模式"),m.value=!0,g.value=decodeURIComponent(i.link),d.value=i.source,h.value=decodeURIComponent(i.platform||""),console.log("[Sharelist] pageLink:",g.value),console.log("[Sharelist] pageSource:",d.value),console.log("[Sharelist] pagePlatform:",h.value),i.name&&(b.value=decodeURIComponent(i.name)),i.picUrl&&(U.value=decodeURIComponent(i.picUrl)),i.author&&(T.value=decodeURIComponent(i.author)),i.playCount&&(C.value=Q(i.playCount)),i.id&&(w.value=i.id),oe()):"user"===i.mode&&"true"===i.fromMyMusic?(console.log("[Sharelist] 进入用户自建歌单模式"),console.log("[Sharelist] playlistId:",i.playlistId),m.value=!1,S.value=!0,_.value=!0,setTimeout(()=>{const e=(t.listStore.state.userLists||[]).find(e=>e.id===i.playlistId);if(console.log("[Sharelist] 查找到的歌单:",e?e.name:"未找到"),e&&e.list&&e.list.length>0){k.value=e.list,A.value=e.list;const l=i.playlistName?decodeURIComponent(i.playlistName):"";b.value=l||e.name||"未知歌单",U.value=e.coverImgUrl||"/static/logo.png",M.value=e.list.length,D.value=!1,_.value=!1,H.value=e.id}else _.value=!1,y.value="歌单暂无歌曲"},100)):"love"===i.mode&&"true"===i.fromMyMusic?(console.log("[Sharelist] 进入我喜欢的音乐模式"),m.value=!1,S.value=!0,_.value=!0,setTimeout(()=>{const e=t.listStore.state.loveList.list||[];console.log("[Sharelist] 喜欢列表数量:",e.length),e.length>0?(k.value=e,A.value=e,b.value="我喜欢的音乐",U.value="/static/logo.png",M.value=e.length,D.value=!1,_.value=!1,H.value=t.LIST_IDS.LOVE):(_.value=!1,y.value="暂无喜欢的音乐")},100)):"recent"===i.mode&&"true"===i.fromMyMusic?(console.log("[Sharelist] 进入最近播放模式"),m.value=!1,S.value=!1,_.value=!0,setTimeout(()=>{const e=s.playerStore.getState().playHistory||[];console.log("[Sharelist] 播放历史数量:",e.length),e.length>0?(k.value=e,b.value="最近播放",U.value="/static/logo.png",M.value=e.length,D.value=!1,_.value=!1,H.value="recent_play_history"):(_.value=!1,y.value="暂无播放记录")},100)):"deleted"===i.mode&&"true"===i.fromMyMusic?(console.log("[Sharelist] 进入最近删除模式"),m.value=!1,S.value=!1,_.value=!0,setTimeout(()=>{let l=[];try{const a=e.index.getStorageSync("deleted_songs");a&&("string"==typeof a?l=JSON.parse(a):Array.isArray(a)?l=a:a.data&&Array.isArray(a.data)&&(l=a.data))}catch(a){console.error("[Sharelist] 解析删除列表失败:",a)}console.log("[Sharelist] 删除列表数量:",l.length),l.length>0?(k.value=l,b.value="最近删除",U.value="/static/logo.png",M.value=l.length,D.value=!1,_.value=!1,H.value="recent_deleted"):(_.value=!1,y.value="暂无删除记录")},100)):(console.log("[Sharelist] 缺少必要参数，无法加载"),y.value="缺少必要参数：link或source")}),e.onShow(()=>{l.setStatusBarTextColor("white"),O()}),e.onUnmounted(()=>{e.index.$off("miniPlayerHeightChange",J)}),(l,a)=>e.e({a:e.unref(c.proxyImageUrl)(U.value),b:e.o(e=>W(e)),c:e.s(L.value),d:e.p({name:"chevron-left",size:"24",color:"#fff"}),e:e.o(V),f:e.t(m.value?"歌单预览":"歌单详情"),g:e.unref(c.proxyImageUrl)(U.value),h:e.o(e=>W(e)),i:C.value},C.value?{j:e.p({name:"play",size:"10",color:"#fff"}),k:e.t(C.value)}:{},{l:e.t(b.value||"加载中..."),m:T.value},T.value?{n:e.t(T.value)}:{},{o:P.value},P.value?{p:e.t(P.value)}:{},{q:e.t(M.value),r:C.value},(C.value,{}),{s:C.value},C.value?{t:e.t(C.value)}:{},{v:S.value},S.value?e.e({w:m.value},m.value?{x:e.p({name:"heart",size:"14",color:"#fff"}),y:e.t("import"===I.value?"导入歌单":"收藏歌单"),z:e.o(ae)}:{},{A:e.p({name:"play",size:"14",color:"#fff"}),B:e.o(X)}):{},{C:_.value&&0===k.value.length},(_.value&&k.value.length,{}),{D:y.value&&!_.value},y.value&&!_.value?{E:e.p({name:"exclamation-circle",size:"48",color:"#999"}),F:e.t(y.value),G:e.o(ee)}:{},{H:k.value.length>0},k.value.length>0?e.e({I:e.f(k.value,(l,a,o)=>{var i,n,r,u;return e.e({a:e.t(a+1),b:e.t(l.name),c:G(l)},(G(l),{}),{d:e.t((u=l.ar||l.singer,u?"string"==typeof u?u:Array.isArray(u)?u.map(e=>e.name||e).join("、"):"未知歌手":"未知歌手")),e:(null==(i=l.al)?void 0:i.name)||l.album},(null==(n=l.al)?void 0:n.name)||l.album?{f:e.t((null==(r=l.al)?void 0:r.name)||l.album)}:{},{g:R.value===a&&j.value},R.value===a&&j.value?{h:"faf7aa06-5-"+o,i:e.p({name:"play",size:"18"})}:R.value!==a||j.value?{}:{k:"faf7aa06-6-"+o,l:e.p({name:"pause",size:"18"})},{j:R.value===a&&!j.value,m:e.t(K(l.dt||l.interval||l.duration)),n:l.id||a,o:R.value===a?1:"",p:e.o(e=>(e=>{R.value!==e?(F(),t.listStore.state.defaultList.list,Y(e)):j.value?s.playerStore.pause():s.playerStore.resume()})(a),l.id||a)})}),J:_.value&&k.value.length>0},(_.value&&k.value.length,{}),{K:!D.value&&k.value.length>0&&!_.value},(!D.value&&k.value.length>0&&_.value,{}),{L:z.value+"px"}):{},{M:!_.value&&!y.value&&0===k.value.length},_.value||y.value||0!==k.value.length?{}:{N:e.p({name:"ban",size:"64",color:"#ccc"})},{O:B.value,P:e.o(Z),Q:!m.value},m.value?{}:{R:e.p({"current-index":2})},{S:E.value?1:""})}},h=e._export_sfc(d,[["__scopeId","data-v-faf7aa06"]]);wx.createPage(h);
