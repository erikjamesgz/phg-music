"use strict";const a=require("../../common/vendor.js"),e=require("../../store/modules/list.js"),n=require("../../store/modules/player.js"),o=require("../../utils/system.js"),i=require("../../utils/musicPic.js"),l=require("../../utils/crypto/wbd.js"),t=require("../../utils/crypto/wy.js"),d=require("../../utils/imageProxy.js"),r=require("../../utils/playSong.js");Math||(s+g)();const s=()=>"../../uni_modules/roc-icon-plus/components/roc-icon-plus/roc-icon-plus.js",g=()=>"../../components/player/MiniPlayer.js",c={__name:"index",setup(s){const g=o.getStatusBarHeight(),c=a.computed(()=>({paddingTop:`${g}px`})),m=[{id:"kw",name:"酷我音乐"},{id:"wy",name:"网易云音乐"},{id:"tx",name:"QQ音乐"},{id:"mg",name:"咪咕音乐"},{id:"kg",name:"酷狗音乐"}],u=a=>{const e={kw:[{id:"kw__93",name:"飙升榜",bangid:"93"},{id:"kw__17",name:"新歌榜",bangid:"17"},{id:"kw__16",name:"热歌榜",bangid:"16"},{id:"kw__158",name:"抖音热歌榜",bangid:"158"},{id:"kw__292",name:"铃声榜",bangid:"292"},{id:"kw__284",name:"热评榜",bangid:"284"},{id:"kw__290",name:"ACG新歌榜",bangid:"290"},{id:"kw__286",name:"台湾KKBOX榜",bangid:"286"},{id:"kw__279",name:"冬日暖心榜",bangid:"279"},{id:"kw__281",name:"巴士随身听榜",bangid:"281"},{id:"kw__255",name:"KTV点唱榜",bangid:"255"},{id:"kw__280",name:"家务进行曲榜",bangid:"280"},{id:"kw__282",name:"熬夜修仙榜",bangid:"282"},{id:"kw__283",name:"枕边轻音乐榜",bangid:"283"},{id:"kw__278",name:"古风音乐榜",bangid:"278"},{id:"kw__264",name:"Vlog音乐榜",bangid:"264"},{id:"kw__242",name:"电音榜",bangid:"242"},{id:"kw__187",name:"流行趋势榜",bangid:"187"},{id:"kw__204",name:"现场音乐榜",bangid:"204"},{id:"kw__186",name:"ACG神曲榜",bangid:"186"},{id:"kw__185",name:"最强翻唱榜",bangid:"185"},{id:"kw__26",name:"经典怀旧榜",bangid:"26"},{id:"kw__104",name:"华语榜",bangid:"104"},{id:"kw__182",name:"粤语榜",bangid:"182"},{id:"kw__22",name:"欧美榜",bangid:"22"},{id:"kw__184",name:"韩语榜",bangid:"184"},{id:"kw__183",name:"日语榜",bangid:"183"},{id:"kw__145",name:"会员畅听榜",bangid:"145"},{id:"kw__153",name:"网红新歌榜",bangid:"153"},{id:"kw__64",name:"影视金曲榜",bangid:"64"},{id:"kw__176",name:"DJ嗨歌榜",bangid:"176"},{id:"kw__106",name:"真声音",bangid:"106"},{id:"kw__12",name:"Billboard榜",bangid:"12"},{id:"kw__49",name:"iTunes音乐榜",bangid:"49"},{id:"kw__180",name:"beatport电音榜",bangid:"180"},{id:"kw__13",name:"英国UK榜",bangid:"13"},{id:"kw__164",name:"百大DJ榜",bangid:"164"},{id:"kw__246",name:"YouTube音乐排行榜",bangid:"246"},{id:"kw__265",name:"韩国Genie榜",bangid:"265"},{id:"kw__14",name:"韩国M-net榜",bangid:"14"},{id:"kw__8",name:"香港电台榜",bangid:"8"}],wy:[{id:"wy__19723756",name:"飙升榜",bangid:"19723756"},{id:"wy__3779629",name:"新歌榜",bangid:"3779629"},{id:"wy__2884035",name:"原创榜",bangid:"2884035"},{id:"wy__3778678",name:"热歌榜",bangid:"3778678"},{id:"wy__991319590",name:"说唱榜",bangid:"991319590"},{id:"wy__71384707",name:"古典榜",bangid:"71384707"},{id:"wy__1978921795",name:"电音榜",bangid:"1978921795"},{id:"wy__5453912201",name:"黑胶VIP爱听榜",bangid:"5453912201"},{id:"wy__71385702",name:"ACG榜",bangid:"71385702"},{id:"wy__745956260",name:"韩语榜",bangid:"745956260"},{id:"wy__10520166",name:"国电榜",bangid:"10520166"},{id:"wy__180106",name:"UK排行榜周榜",bangid:"180106"},{id:"wy__60198",name:"美国Billboard榜",bangid:"60198"},{id:"wy__3812895",name:"Beatport全球电子舞曲榜",bangid:"3812895"},{id:"wy__21845217",name:"KTV唛榜",bangid:"21845217"},{id:"wy__60131",name:"日本Oricon榜",bangid:"60131"},{id:"wy__2809513713",name:"欧美热歌榜",bangid:"2809513713"},{id:"wy__2809577409",name:"欧美新歌榜",bangid:"2809577409"},{id:"wy__27135204",name:"法国 NRJ Vos Hits 周榜",bangid:"27135204"},{id:"wy__3001835560",name:"ACG动画榜",bangid:"3001835560"},{id:"wy__3001795926",name:"ACG游戏榜",bangid:"3001795926"},{id:"wy__3001890046",name:"ACG VOCALOID榜",bangid:"3001890046"},{id:"wy__3112516681",name:"中国新乡村音乐排行榜",bangid:"3112516681"},{id:"wy__5059644681",name:"日语榜",bangid:"5059644681"},{id:"wy__5059633707",name:"摇滚榜",bangid:"5059633707"},{id:"wy__5059642708",name:"国风榜",bangid:"5059642708"},{id:"wy__5338990334",name:"潜力爆款榜",bangid:"5338990334"},{id:"wy__5059661515",name:"民谣榜",bangid:"5059661515"},{id:"wy__6688069460",name:"听歌识曲榜",bangid:"6688069460"},{id:"wy__6723173524",name:"网络热歌榜",bangid:"6723173524"},{id:"wy__6732051320",name:"俄语榜",bangid:"6732051320"},{id:"wy__6732014811",name:"越南语榜",bangid:"6732014811"},{id:"wy__6886768100",name:"中文DJ榜",bangid:"6886768100"},{id:"wy__6939992364",name:"俄罗斯top hit流行音乐榜",bangid:"6939992364"},{id:"wy__7095271308",name:"泰语榜",bangid:"7095271308"},{id:"wy__7356827205",name:"BEAT排行榜",bangid:"7356827205"},{id:"wy__7325478166",name:"编辑推荐榜",bangid:"7325478166"},{id:"wy__7603212484",name:"LOOK直播歌曲榜",bangid:"7603212484"},{id:"wy__7775163417",name:"赏音榜",bangid:"7775163417"},{id:"wy__7785123708",name:"黑胶VIP新歌榜",bangid:"7785123708"},{id:"wy__7785066739",name:"黑胶VIP热歌榜",bangid:"7785066739"},{id:"wy__7785091694",name:"黑胶VIP爱搜榜",bangid:"7785091694"}],tx:[{id:"tx__4",name:"流行指数榜",bangid:"4"},{id:"tx__26",name:"热歌榜",bangid:"26"},{id:"tx__27",name:"新歌榜",bangid:"27"},{id:"tx__62",name:"飙升榜",bangid:"62"},{id:"tx__58",name:"说唱榜",bangid:"58"},{id:"tx__57",name:"喜力电音榜",bangid:"57"},{id:"tx__28",name:"网络歌曲榜",bangid:"28"},{id:"tx__5",name:"内地榜",bangid:"5"},{id:"tx__3",name:"欧美榜",bangid:"3"},{id:"tx__59",name:"香港地区榜",bangid:"59"},{id:"tx__16",name:"韩国榜",bangid:"16"},{id:"tx__60",name:"抖快榜",bangid:"60"},{id:"tx__29",name:"影视金曲榜",bangid:"29"},{id:"tx__17",name:"日本榜",bangid:"17"},{id:"tx__52",name:"腾讯音乐人原创榜",bangid:"52"},{id:"tx__36",name:"K歌金曲榜",bangid:"36"},{id:"tx__61",name:"台湾地区榜",bangid:"61"},{id:"tx__63",name:"DJ舞曲榜",bangid:"63"},{id:"tx__64",name:"综艺新歌榜",bangid:"64"},{id:"tx__65",name:"国风热歌榜",bangid:"65"},{id:"tx__67",name:"听歌识曲榜",bangid:"67"},{id:"tx__72",name:"动漫音乐榜",bangid:"72"},{id:"tx__73",name:"游戏音乐榜",bangid:"73"},{id:"tx__75",name:"有声榜",bangid:"75"},{id:"tx__131",name:"校园音乐人排行榜",bangid:"131"}],mg:[{id:"mg__27553319",name:"新歌榜",bangid:"27553319"},{id:"mg__27186466",name:"热歌榜",bangid:"27186466"},{id:"mg__27553408",name:"原创榜",bangid:"27553408"},{id:"mg__75959118",name:"音乐风向榜",bangid:"75959118"},{id:"mg__76557036",name:"彩铃分贝榜",bangid:"76557036"},{id:"mg__76557745",name:"会员臻爱榜",bangid:"76557745"},{id:"mg__23189800",name:"港台榜",bangid:"23189800"},{id:"mg__23189399",name:"内地榜",bangid:"23189399"},{id:"mg__19190036",name:"欧美榜",bangid:"19190036"},{id:"mg__83176390",name:"国风金曲榜",bangid:"83176390"}],kg:[{id:"kg__6666",name:"飙升榜",bangid:"6666"},{id:"kg__8888",name:"TOP500",bangid:"8888"},{id:"kg__59703",name:"蜂鸟流行音乐榜",bangid:"59703"},{id:"kg__52144",name:"抖音热歌榜",bangid:"52144"},{id:"kg__52767",name:"快手热歌榜",bangid:"52767"},{id:"kg__24971",name:"DJ热歌榜",bangid:"24971"},{id:"kg__23784",name:"网络红歌榜",bangid:"23784"},{id:"kg__44412",name:"说唱先锋榜",bangid:"44412"},{id:"kg__31308",name:"内地榜",bangid:"31308"},{id:"kg__33160",name:"电音榜",bangid:"33160"},{id:"kg__31313",name:"香港地区榜",bangid:"31313"},{id:"kg__51341",name:"民谣榜",bangid:"51341"},{id:"kg__54848",name:"台湾地区榜",bangid:"54848"},{id:"kg__31310",name:"欧美榜",bangid:"31310"},{id:"kg__33162",name:"ACG新歌榜",bangid:"33162"},{id:"kg__31311",name:"韩国榜",bangid:"31311"},{id:"kg__31312",name:"日本榜",bangid:"31312"},{id:"kg__49225",name:"80后热歌榜",bangid:"49225"},{id:"kg__49223",name:"90后热歌榜",bangid:"49223"},{id:"kg__49224",name:"00后热歌榜",bangid:"49224"},{id:"kg__33165",name:"粤语金曲榜",bangid:"33165"},{id:"kg__33166",name:"欧美金曲榜",bangid:"33166"},{id:"kg__33163",name:"影视金曲榜",bangid:"33163"},{id:"kg__51340",name:"伤感榜",bangid:"51340"},{id:"kg__35811",name:"会员专享榜",bangid:"35811"},{id:"kg__37361",name:"雷达榜",bangid:"37361"},{id:"kg__21101",name:"分享榜",bangid:"21101"},{id:"kg__46910",name:"综艺新歌榜",bangid:"46910"},{id:"kg__30972",name:"酷狗音乐人原创榜",bangid:"30972"},{id:"kg__60170",name:"闽南语榜",bangid:"60170"},{id:"kg__65234",name:"儿歌榜",bangid:"65234"},{id:"kg__4681",name:"美国BillBoard榜",bangid:"4681"},{id:"kg__25028",name:"Beatport电子舞曲榜",bangid:"25028"},{id:"kg__4680",name:"英国单曲榜",bangid:"4680"},{id:"kg__38623",name:"韩国Melon音乐榜",bangid:"38623"},{id:"kg__42807",name:"joox本地热歌榜",bangid:"42807"},{id:"kg__36107",name:"小语种热歌榜",bangid:"36107"},{id:"kg__4673",name:"日本Oricon榜",bangid:"4673"},{id:"kg__4683",name:"台湾Hito中文榜",bangid:"4683"},{id:"kg__4684",name:"中国TOP排行榜",bangid:"4684"},{id:"kg__4682",name:"香港电台中文歌曲龙虎榜",bangid:"4682"},{id:"kg__4685",name:"中国嘻哈榜",bangid:"4685"},{id:"kg__12861",name:"酷狗top500榜",bangid:"12861"}]};return e[a]||e.kw},_=a.ref("kw"),b=a.ref(""),v=a.ref(""),p=a.ref([]),w=a.ref([]),h=a.ref(1),k=a.ref(!0),y=a.ref(!1),f=a.ref(!1),S=a.ref(!1),x=a.ref(""),I=a.ref(!1),M=a.ref(!1),T=a.ref(null),L=a.ref(0),B=a.computed(()=>n.playerStore.getState().showMiniPlayer),C=a.computed(()=>n.playerStore.getState().currentSong),P=a.ref(!1),A=()=>{P.value="true"===a.index.getStorageSync("darkMode"),console.log("[Rank] 初始化暗黑模式:",P.value)},j=a.computed(()=>{const a=m.find(a=>a.id===_.value);return a?a.name:"酷我音乐"}),z=()=>{a.index.navigateBack()},q=async a=>{console.log("[排行榜] selectBoard 开始:",a.name,a.id),b.value=a.id,v.value=a.name,h.value=1,w.value=[],k.value=!0,U({source:_.value,boardId:a.id}),await N(),console.log("[排行榜] selectBoard 完成后的 songList:",w.value.length,"首")},O=async a=>{console.log("[排行榜] selectBoardWithoutSave 开始:",a.name,a.id),b.value=a.id,v.value=a.name,h.value=1,w.value=[],k.value=!0,console.log("[排行榜] 临时模式：不保存设置"),await N(),console.log("[排行榜] selectBoardWithoutSave 完成后的 songList:",w.value.length,"首")},U=e=>{try{a.index.setStorageSync("leaderboardSetting",JSON.stringify(e)),console.log("[排行榜] 保存设置:",e)}catch(n){console.error("[排行榜] 保存设置失败:",n)}},K=async()=>{console.log("[排行榜] loadBoardList 开始, 音源:",_.value),console.log("[排行榜] loadBoardList boardList当前值:",p.value.length),y.value=!0;try{const a=u(_.value);console.log("[排行榜] loadBoardList 获取到榜单数量:",a.length),console.log("[排行榜] loadBoardList 榜单列表:",a.map(a=>a.name).join(", ")),p.value=a,console.log("[排行榜] loadBoardList boardList已更新:",p.value.length),!b.value&&a.length>0&&(console.log("[排行榜] 自动选中第一个榜单:",a[0].name),await q(a[0]))}catch(a){console.error("[排行榜] 加载榜单列表失败:",a),x.value="加载榜单失败"}finally{y.value=!1,console.log("[排行榜] loadBoardList 完成")}},N=async(a=!1)=>{var e;if(console.log("[排行榜] loadSongList 开始, isLoadMore:",a,"boardId:",b.value,"currentPage:",h.value),b.value){a?f.value=!0:y.value=!0;try{const[n,o]=b.value.split("__");console.log("[排行榜] 解析榜单ID: source:",n,"bangid:",o),console.log("[排行榜] 开始获取歌曲列表, page:",h.value);const i=await R(n,o,h.value);console.log("[排行榜] 获取到歌曲数量:",null==(e=i.list)?void 0:e.length,"total:",i.total),w.value=a?[...w.value,...i.list]:i.list;const l=w.value.length;k.value=i.total>0?l<i.total:i.list.length>=30,console.log("[排行榜] 已加载:",l,"首, 总数:",i.total,"是否还有更多:",k.value)}catch(n){console.error("[排行榜] 加载歌曲列表失败:",n),x.value="加载歌曲失败"}finally{y.value=!1,f.value=!1,S.value=!1,console.log("[排行榜] loadSongList 完成, 当前列表长度:",w.value.length)}}else console.log("[排行榜] 没有选中的榜单，跳过加载")},R=async(a,e,n)=>{var o;console.log("[排行榜] fetchBoardSongs 开始, source:",a,"bangid:",e,"page:",n);const i={kw:$,wy:G,tx:J,mg:Q,kg:D}[a]||$,l=await i(e,n);return console.log("[排行榜] fetchBoardSongs 返回:",null==(o=l.list)?void 0:o.length,"首, total:",l.total),l},$=async(e,n)=>{console.log("[排行榜] fetchKwBoardSongs 开始, bangid:",e,"page:",n);try{const i={uid:"",devId:"",sFrom:"kuwo_sdk",user_type:"AP",carSource:"kwplayercar_ar_6.0.1.0_apk_keluze.apk",id:e,pn:n-1,rn:100};let t;console.log("[排行榜] 发起酷我榜单请求，使用 wbdCrypto 加密"),console.log("[排行榜] 请求体:",JSON.stringify(i));try{t=l.wbdCrypto.buildParam(i),console.log("[排行榜] 构建的参数长度:",null==t?void 0:t.length),console.log("[排行榜] 完整URL:",`https://wbd.kuwo.cn/api/bd/bang/bang_info?${t}`)}catch(o){return console.error("[排行榜] buildParam 异常:",o),[]}const d=`https://wbd.kuwo.cn/api/bd/bang/bang_info?${t}`;console.log("[排行榜] 最终请求URL:",d);const r=await a.index.request({url:d,method:"GET",header:{"User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X)",Referer:"https://music.kuwo.cn/"}});if(console.log("[排行榜] 酷我榜单响应:",r.errMsg),console.log("[排行榜] 酷我榜单响应状态码:",r.statusCode),console.log("[排行榜] 酷我榜单响应数据类型:",typeof r.data),console.log("[排行榜] 酷我榜单响应数据:",r.data),"request:ok"!==r.errMsg)return console.error("[排行榜] 酷我榜单请求失败:",r.errMsg),[];if(!r.data)return console.error("[排行榜] 酷我榜单无响应数据"),[];let s;console.log("[排行榜] 酷我榜单原始响应:",JSON.stringify(r.data).substring(0,200));try{s=l.wbdCrypto.decodeData(r.data),console.log("[排行榜] 酷我榜单解密后数据:",JSON.stringify(s).substring(0,200))}catch(o){return console.error("[排行榜] 解密失败:",o),console.error("[排行榜] 原始响应:",r.data),[]}if(200!=s.code||!s.data||!s.data.musiclist)return console.error("[排行榜] 酷我榜单返回错误:",s),[];console.log("[排行榜] 酷我榜单歌曲数量:",s.data.musiclist.length),console.log("[排行榜] 酷我榜单total:",s.data.total);const g=s.data.musiclist.map((a,e)=>({id:a.musicrid||a.id,name:a.name||"未知歌曲",singer:a.artist||"未知歌手",album:a.album||"",duration:a.duration||0,source:"kw",musicrid:a.musicrid,albumid:a.albumid,pic:a.pic}));return console.log("[排行榜] 酷我榜单解析歌曲数量:",g.length),{list:g,total:parseInt(s.data.total)||g.length}}catch(i){return console.error("[排行榜] 酷我榜单获取失败:",i),{list:[],total:0}}},G=async(e,n)=>{var o;console.log("[排行榜] fetchWyBoardSongs 开始, bangid:",e,"page:",n);try{const n=t.weapi({id:e,n:"1000",s:"0"});console.log("[排行榜] 网易云榜单请求参数:",JSON.stringify(n).substring(0,100));const i=await a.index.request({url:"https://music.163.com/weapi/v3/playlist/detail",method:"POST",header:{"Content-Type":"application/x-www-form-urlencoded","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Referer:"https://music.163.com"},data:`params=${encodeURIComponent(n.params)}&encSecKey=${encodeURIComponent(n.encSecKey)}`});if(console.log("[排行榜] 网易云榜单响应状态:",i.statusCode),i.data&&200===i.data.code&&i.data.playlist&&i.data.playlist.tracks){console.log("[排行榜] 网易云榜单歌曲数量:",i.data.playlist.tracks.length),console.log("[排行榜] 网易云榜单total:",null==(o=i.data.playlist.trackIds)?void 0:o.length);const a=i.data.playlist.tracks.map((a,e)=>({id:a.id,name:a.name||"未知歌曲",singer:a.ar?a.ar.map(a=>a.name).join(" / "):"未知歌手",album:a.al?a.al.name:"",duration:Math.floor(a.dt/1e3)||0,source:"wy",al:a.al,ar:a.ar}));return{list:a,total:a.length}}return console.error("[排行榜] 网易云榜单响应异常:",i.data),{list:[],total:0}}catch(i){return console.error("[排行榜] 网易云榜单获取失败:",i),{list:[],total:0}}},J=async(e,n)=>{console.log("[排行榜] fetchTxBoardSongs 开始, bangid:",e,"page:",n);try{const o=100,i=(n-1)*o,l=await a.index.request({url:"https://u.y.qq.com/cgi-bin/musicu.fcg",method:"POST",data:{comm:{g_tk:5381,uin:0,format:"json",inCharset:"utf-8",outCharset:"utf-8",notice:0,platform:"h5",needNewCode:1},detail:{module:"musicToplist.ToplistInfoServer",method:"GetDetail",param:{topId:parseInt(e),offset:i,num:o,period:""}}},header:{"Content-Type":"application/json","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Referer:"https://y.qq.com"}});if(console.log("[排行榜] QQ音乐榜单响应状态:",l.statusCode),l.data&&l.data.detail&&l.data.detail.data&&l.data.detail.data.songInfoList){console.log("[排行榜] QQ音乐榜单歌曲数量:",l.data.detail.data.songInfoList.length),console.log("[排行榜] QQ音乐榜单total:",l.data.detail.data.totalNum);const a=l.data.detail.data.songInfoList.map((a,e)=>{let n="";return a.album&&a.album.name&&""!==a.album.name&&"空"!==a.album.name?n=`https://y.gtimg.cn/music/photo_new/T002R500x500M000${a.album.mid}.jpg`:a.singer&&a.singer.length>0&&(n=`https://y.gtimg.cn/music/photo_new/T001R500x500M000${a.singer[0].mid}.jpg`),{id:a.id||a.songId,name:a.name||a.title||"未知歌曲",singer:a.singer?a.singer.map(a=>a.name).join(" / "):"未知歌手",album:a.album?a.album.name:"",duration:a.interval||0,source:"tx",songmid:a.mid||a.songmid,img:n,albumMid:a.album?a.album.mid:"",singerMid:a.singer&&a.singer.length>0?a.singer[0].mid:""}});return{list:a,total:l.data.detail.data.totalNum||a.length}}return console.error("[排行榜] QQ音乐榜单响应异常:",l.data),{list:[],total:0}}catch(o){return console.error("[排行榜] QQ音乐榜单获取失败:",o),{list:[],total:0}}},Q=async(e,n)=>{var o,i,l;console.log("[排行榜] fetchMgBoardSongs 开始, bangid:",e,"page:",n);try{const n=`https://app.c.nf.migu.cn/MIGUM2.0/v1.0/content/querycontentbyId.do?columnId=${e}&needAll=0`;console.log("[排行榜] 咪咕榜单请求 URL:",n);const t=await a.index.request({url:n,method:"GET",header:{"User-Agent":"Mozilla/5.0 (Linux; Android 5.1.1; Nexus 6 Build/LYZ28E) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.115 Mobile Safari/537.36",Referer:"https://app.c.nf.migu.cn/",channel:"0146921"}});if(console.log("[排行榜] 咪咕榜单响应状态:",t.statusCode),console.log("[排行榜] 咪咕榜单响应数据:",JSON.stringify(t.data).substring(0,300)),200!==t.statusCode||"000000"!==(null==(o=t.data)?void 0:o.code))return console.error("[排行榜] 咪咕榜单请求失败:",t.data),[];const d=null==(l=null==(i=t.data)?void 0:i.columnInfo)?void 0:l.contents;if(!d||!Array.isArray(d))return console.error("[排行榜] 咪咕榜单无 contents 数据:",t.data),[];console.log("[排行榜] 咪咕榜单 contents 数量:",d.length);const r=d.map((a,e)=>{const n=a.objectInfo||a;0===e&&(console.log("[排行榜] 咪咕歌曲 length 字段:",n.length,"类型:",typeof n.length),console.log("[排行榜] 咪咕歌曲 duration 字段:",n.duration,"类型:",typeof n.duration));let o="";n.landscapImg?o=n.landscapImg:n.albumImgs&&n.albumImgs.length>0&&(o=n.albumImgs[0].img||"");let i=0;if(n.length&&"string"==typeof n.length){const a=n.length.match(/^(?:(\d+):)?(\d+):(\d+)$/);if(a){i=3600*parseInt(a[1]||"0")+60*parseInt(a[2])+parseInt(a[3]),0===e&&console.log("[排行榜] 咪咕歌曲时长解析:",n.length,"->",i,"秒")}else 0===e&&console.log("[排行榜] 咪咕歌曲时长匹配失败:",n.length)}else n.duration&&(i=parseInt(n.duration),0===e&&console.log("[排行榜] 咪咕歌曲使用 duration 字段:",i));return{id:n.copyrightId||n.songId||n.id,name:n.songName||n.title||"未知歌曲",singer:n.singerName||n.singer||"未知歌手",album:n.album||n.albumName||"",duration:i,source:"mg",copyrightId:n.copyrightId,songId:n.songId,songmid:n.songId,img:o,albumId:n.albumId,singerId:n.singerId}});return console.log("[排行榜] 咪咕榜单解析歌曲数量:",r.length),{list:r,total:r.length}}catch(t){return console.error("[排行榜] 咪咕榜单获取失败:",t),console.error("[排行榜] 错误堆栈:",null==t?void 0:t.stack),{list:[],total:0}}},D=async(e,n)=>{console.log("[排行榜] fetchKgBoardSongs 开始, bangid:",e,"page:",n);try{const o=`http://mobilecdnbj.kugou.com/api/v3/rank/song?version=9108&ranktype=1&plat=0&pagesize=${100}&area_code=1&page=${n}&rankid=${e}&with_res_tag=0&show_portrait_mv=1`;console.log("[排行榜] 酷狗榜单请求URL:",o);const i=await a.index.request({url:o,method:"GET",header:{"User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X) AppleWebKit/605.1.15",Referer:"https://www.kugou.com"}});if(console.log("[排行榜] 酷狗榜单响应状态:",i.statusCode),console.log("[排行榜] 酷狗榜单响应数据:",i.data?"有数据":"无数据"),i.data&&0===i.data.errcode&&i.data.data&&i.data.data.info){console.log("[排行榜] 酷狗榜单歌曲数量:",i.data.data.info.length),console.log("[排行榜] 酷狗榜单total:",i.data.data.total);const a=i.data.data.info.map((a,e)=>{var n,o;let i="";a.album_sizable_cover?i=a.album_sizable_cover.replace("{size}","150"):a.trans_param&&a.trans_param.union_cover&&(i=a.trans_param.union_cover.replace("{size}","150"));let l="";return a.authors&&a.authors.length>0&&a.authors[0].sizable_avatar&&(l=a.authors[0].sizable_avatar.replace("{size}","150")),{id:a.hash||a.audio_id,name:a.songname||a.filename&&(null==(n=a.filename.split("-")[1])?void 0:n.trim())||"未知歌曲",singer:a.singername||a.filename&&(null==(o=a.filename.split("-")[0])?void 0:o.trim())||"未知歌手",album:a.album_name||a.remark||"",duration:a.duration||0,source:"kg",hash:a.hash,album_id:a.album_id,audio_id:a.audio_id,img:i,singerImg:l,mvhash:a.mvhash,sqhash:a.sqhash,"320hash":a["320hash"]}});return{list:a,total:i.data.data.total||a.length}}return console.error("[排行榜] 酷狗榜单响应异常:",i.data),{list:[],total:0}}catch(o){return console.error("[排行榜] 酷狗榜单获取失败:",o),console.error("[排行榜] 错误详情:",o.message||o),{list:[],total:0}}};let W=null,V=0;const E=()=>{const e=a.index.createSelectorQuery();e.select(".list-wrapper").boundingClientRect(),e.select(".list-wrapper").scrollOffset(),e.exec(a=>{if(!a[0]||!a[1])return void console.log("[排行榜] onScroll: 无法获取滚动信息");const e=a[0],n=a[1],o=n.scrollTop,i=n.scrollHeight,l=e.height,t=i-o-l;Math.abs(o-V)>100&&(console.log("[排行榜] === onScroll ==="),console.log("[排行榜] scrollTop:",o),console.log("[排行榜] scrollHeight:",i),console.log("[排行榜] clientHeight:",l),console.log("[排行榜] scrollBottom:",t),console.log("[排行榜] hasMore:",k.value),console.log("[排行榜] isLoadingMore:",f.value),console.log("[排行榜] isLoading:",y.value),V=o),t<100&&k.value&&!f.value&&!y.value&&(console.log("[排行榜] 触发自动加载更多, scrollBottom:",t),W&&clearTimeout(W),W=setTimeout(()=>{F()},200))})},H=()=>{E()},F=()=>{console.log("=== loadMore 触发 ==="),console.log("hasMore:",k.value),console.log("isLoadingMore:",f.value),console.log("currentPage:",h.value),!k.value||f.value||y.value?console.log("loadMore 被拦截"):(console.log("loadMore 执行：准备加载下一页"),h.value++,f.value=!0,N(!0))},X=()=>{x.value="",N()},Y=a=>i.getSongPicUrl(a),Z=a=>"string"==typeof a.singer?a.singer:a.ar&&Array.isArray(a.ar)?a.ar.map(a=>a.name).join(" / "):"未知歌手",aa=a=>{if(!a||a<=0)return"00:00";const e=Math.floor(a/60),n=Math.floor(a%60);return`${e.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},ea=a=>{const e=C.value;return!!e&&(e.id===a.id&&e.source===a.source)},na=async(e,n)=>{if(console.log("[排行榜] 播放歌曲:",e.name,"索引:",n),!e||!e.id)return console.error("[排行榜] 歌曲对象无效:",e),void a.index.showToast({title:"歌曲信息无效",icon:"none"});const o={...e,id:String(e.id)};await r.playSongCommon(o,{addToDefaultList:!0,source:e.source||"kw"})},oa=(a,e)=>{T.value=a,L.value=e,M.value=!0},ia=()=>{M.value=!1,T.value=null},la=()=>{T.value&&na(T.value,L.value),ia()},ta=()=>{T.value&&(e.listStore.addTempPlayList(T.value,e.LIST_IDS.DEFAULT,!0),a.index.showToast({title:"已添加到下一首",icon:"none"})),ia()},da=()=>{T.value&&a.index.navigateTo({url:`/pages/playlist-select/index?songId=${T.value.id}&source=${T.value.source}`}),ia()},ra=()=>{T.value&&(e.listStore.addToLoveList(T.value),a.index.showToast({title:"收藏成功",icon:"success"})),ia()};a.onMounted(()=>{console.log("[排行榜] onMounted 开始初始化"),o.setStatusBarTextColor("dark"),A(),sa()}),a.onShow(()=>{o.setStatusBarTextColor("dark"),A()});const sa=async()=>{console.log("[排行榜] initPage 开始");try{const e=a.index.getStorageSync("rank_temp_source"),n=a.index.getStorageSync("rank_temp_boardId");if(a.index.removeStorageSync("rank_temp_source"),a.index.removeStorageSync("rank_temp_boardId"),e&&n){console.log("[排行榜] 从首页热歌榜跳转，使用临时参数:",e,n),_.value=e;const a=u(e);p.value=a,console.log("[排行榜] 临时模式加载榜单数量:",a.length);const o=a.find(a=>a.id===n);return o?(console.log("[排行榜] 选中热歌榜:",o.name),await O(o)):a.length>0&&(console.log("[排行榜] 未找到指定榜单，选中第一个"),await O(a[0])),void console.log("[排行榜] initPage 完成（临时模式，不保存设置）")}const o=await ga();console.log("[排行榜] 获取到设置:",o);if(a.index.getStorageSync("leaderboardSetting")||(console.log("[排行榜] 首次进入，保存默认设置"),U({source:"kw",boardId:"kw__16"})),_.value=o.source,await K(),o.boardId){const a=p.value.find(a=>a.id===o.boardId);a?(console.log("[排行榜] 选中保存的榜单:",a.name),await q(a)):p.value.length>0&&(console.log("[排行榜] 未找到保存的榜单，选中第一个"),await q(p.value[0]))}else p.value.length>0&&(console.log("[排行榜] 没有保存的榜单，选中第一个"),await q(p.value[0]))}catch(e){console.error("[排行榜] 初始化失败:",e),a.index.showToast({title:"初始化失败",icon:"none"})}console.log("[排行榜] initPage 完成")},ga=()=>new Promise(e=>{try{const n=a.index.getStorageSync("leaderboardSetting");if(console.log("[排行榜] 从storage读取原始数据:",n),n){const a=JSON.parse(n);console.log("[排行榜] 解析后的设置:",a),e(a)}else console.log("[排行榜] storage为空，使用默认值"),e({source:"kw",boardId:"kw__16"})}catch(n){console.error("[排行榜] 读取设置失败:",n),e({source:"kw",boardId:"kw__16"})}});return a.watch(_,()=>{console.log("[排行榜] 音源变化:",_.value),K()}),(e,n)=>{var o;return a.e({a:a.p({name:"chevron-left",size:"24",color:"#333"}),b:a.o(z),c:a.t(j.value),d:a.p({name:"chevron-down",size:"14",color:"#666"}),e:a.o(a=>I.value=!0),f:a.f(p.value,(e,n,o)=>({a:a.t(e.name),b:e.id,c:b.value===e.id?1:"",d:a.o(a=>q(e),e.id)})),g:a.s(c.value),h:y.value&&0===w.value.length},(y.value&&w.value.length,{}),{i:x.value&&!y.value},x.value&&!y.value?{j:a.p({name:"exclamation-circle",size:"48",color:"#999"}),k:a.t(x.value),l:a.o(X)}:{},{m:w.value.length>0},w.value.length>0?{n:a.f(w.value,(e,n,o)=>a.e({a:a.t(n+1),b:n<3?1:"",c:a.unref(d.proxyImageUrl)(Y(e)),d:a.o(a=>((a,e)=>{if(!e)return;const n=Y(e);if(!n)return;let o=0;n.includes("wsrv.nl")?o=1:n.includes("weserv.nl")?o=2:n.includes("jina.ai")&&(o=3),d.handleImageError(a,n,o)})(a,e),e.id||n),e:ea(e)},ea(e)?{f:a.f(4,(a,e,n)=>({a:a,b:.1*a+"s"}))}:{},{g:a.t(e.name),h:ea(e)?1:"",i:a.t(Z(e)),j:e.album},(e.album,{}),{k:e.album},e.album?{l:a.t(e.album)}:{},{m:a.t(aa(e.duration)),n:"f0791970-3-"+o,o:a.o(a=>oa(e,n),e.id||n),p:e.id||n,q:a.o(a=>na(e,n),e.id||n),r:a.o(a=>oa(e,n),e.id||n)})),o:a.p({name:"ellipsis-vertical",size:"18",color:"#999"})}:{},{p:w.value.length>0},w.value.length>0?a.e({q:f.value},(f.value||k.value,{}),{r:!k.value}):{},{s:!y.value&&!x.value&&0===w.value.length},(y.value||x.value||w.value.length,{}),{t:a.o(E),v:a.o(H),w:I.value},I.value?{x:a.p({name:"xmark",size:"20",color:"#999"}),y:a.o(a=>I.value=!1),z:a.f(m,(e,n,o)=>a.e({a:a.t(e.name),b:_.value===e.id},_.value===e.id?{c:"f0791970-5-"+o,d:a.p({name:"check",size:"16",color:"#00d7cd"})}:{},{e:e.id,f:_.value===e.id?1:"",g:a.o(a=>{return n=e.id,_.value=n,b.value="",h.value=1,w.value=[],k.value=!0,x.value="",I.value=!1,void K();var n},e.id)})),A:a.o(()=>{}),B:a.o(a=>I.value=!1)}:{},{C:M.value},M.value?{D:a.t(null==(o=T.value)?void 0:o.name),E:a.t(Z(T.value)),F:a.p({name:"play",size:"18",color:"#00d7cd"}),G:a.o(la),H:a.p({name:"forward",size:"18",color:"#00d7cd"}),I:a.o(ta),J:a.p({name:"plus",size:"18",color:"#00d7cd"}),K:a.o(da),L:a.p({name:"heart",size:"18",color:"#ff6b6b"}),M:a.o(ra),N:a.o(ia),O:a.o(()=>{}),P:a.o(ia)}:{},{Q:B.value},(B.value,{}),{R:P.value?1:""})}}},m=a._export_sfc(c,[["__scopeId","data-v-f0791970"]]);wx.createPage(m);
