"use strict";const e=require("../../common/vendor.js");Math||t();const t=()=>"../../uni_modules/roc-icon-plus/components/roc-icon-plus/roc-icon-plus.js",l={__name:"VirtualList",props:{items:{type:Array,default:()=>[]},itemHeight:{type:Number,default:60},height:{type:String,default:"100%"},bufferSize:{type:Number,default:5},itemKey:{type:[String,Function],default:"id"},loading:{type:Boolean,default:!1},scrollWithAnimation:{type:Boolean,default:!1},lowerThreshold:{type:Number,default:50},currentPlayIndex:{type:Number,default:-1},isPlaying:{type:Boolean,default:!1},darkMode:{type:Boolean,default:!1}},emits:["scroll","scrolltolower","item-click","more-click"],setup(t,{expose:l,emit:o}){const i=t,a=o,r=e.getCurrentInstance(),n=e.ref(0),u=e.ref(0),s=e.ref(0),c=e.ref(0),d=e.ref(i.itemHeight),m=e.computed(()=>(c.value,n.value)),p=e.computed(()=>{const e=Math.floor(s.value/d.value)-i.bufferSize;return Math.max(0,e)}),g=e.computed(()=>{const e=Math.ceil(u.value/d.value),t=p.value+e+2*i.bufferSize;return Math.min(i.items.length,t)}),v=e.computed(()=>i.items.slice(p.value,g.value)),h=e.computed(()=>p.value*d.value),f=e.computed(()=>{const e=i.items.length-g.value;return Math.max(0,e*d.value)}),y=e.computed(()=>i.height),x=(e,t)=>"function"==typeof i.itemKey?i.itemKey(e,t):e[i.itemKey]||t,M=e=>{s.value=e.detail.scrollTop,a("scroll",e)},S=()=>{a("scrolltolower")},b=e=>i.currentPlayIndex===e,k=e=>{if(!e)return"00:00";if("string"==typeof e&&e.includes(":"))return e;let t,l=Number(e);if(isNaN(l))return"00:00";t=l>3600?Math.floor(l/1e3):Math.floor(l);const o=t%60;return`${Math.floor(t/60).toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`},T=e=>"SQ"===e.quality||e.sq||e.h||e.hr||e.types&&e.types.some(e=>"SQ"===e.type);return e.watch(()=>i.items.length,(e,t)=>{console.log("[VirtualList] 列表长度变化:",t,"->",e)}),l({scrollToIndex:(e,t=!0)=>{if(e<0||e>=i.items.length)return void console.warn("[VirtualList] scrollToIndex: 索引超出范围",e);console.log("[VirtualList] scrollToIndex:",e,"actualItemHeight:",d.value);const l=e*d.value;console.log("[VirtualList] 计算滚动位置:",l,"当前scrollTop:",s.value),c.value++,n.value=l,console.log("[VirtualList] 已设置 scrollTopValue:",l,"forceScrollFlag:",c.value)},scrollTo:(e,t=!0)=>{c.value++,n.value=e},getVisibleRange:()=>({start:p.value,end:g.value})}),e.onMounted(()=>{setTimeout(()=>{e.index.createSelectorQuery().in(r).select(".virtual-list").boundingClientRect(e=>{e&&(u.value=e.height,console.log("[VirtualList] 视口高度:",u.value))}).exec(),setTimeout(()=>{e.index.createSelectorQuery().in(r).select(".song-item").boundingClientRect(e=>{e&&e.height>0?(d.value=e.height,console.log("[VirtualList] 实际项目高度:",e.height,"px")):console.log("[VirtualList] 使用默认项目高度:",i.itemHeight)}).exec()},200)},100)}),(l,o)=>e.e({a:h.value+"px",b:e.f(v.value,(l,o,i)=>{return e.e({a:e.t(p.value+o+1),b:e.t(l.name),c:T(l)},(T(l),{}),{d:e.t((n=l.ar||l.singer,n?"string"==typeof n?n:Array.isArray(n)?n.map(e=>"string"==typeof e?e:e.name||"").filter(Boolean).join("、")||"未知歌手":n.name||"未知歌手":"未知歌手")),e:b(p.value+o)&&t.isPlaying},b(p.value+o)&&t.isPlaying?{f:"7ce8dee2-0-"+i,g:e.p({name:"play",size:"18"})}:{},{h:e.t(k(l.dt||l.interval||l.duration)),i:"7ce8dee2-1-"+i,j:e.o(e=>((e,t)=>{a("more-click",{index:e,item:t})})(p.value+o,l),x(l,o)),k:x(l,o),l:(r=p.value+o,`virtual-item-${r}`),m:b(p.value+o)?1:"",n:e.o(e=>((e,t)=>{a("item-click",{index:e,item:t})})(p.value+o,l),x(l,o))});var r,n}),c:e.p({name:"ellipsis-vertical",size:"18"}),d:t.darkMode?1:"",e:f.value+"px",f:0===t.items.length&&!t.loading},0!==t.items.length||t.loading?{}:{g:e.p({name:"music",size:"48",color:t.darkMode?"#666":"#ccc"}),h:t.darkMode?"#666":"#999",i:t.darkMode?"#555":"#ccc"},{j:t.loading},(t.loading,{}),{k:y.value,l:e.o(M),m:m.value,n:t.scrollWithAnimation,o:t.lowerThreshold,p:e.o(S)})}},o=e._export_sfc(l,[["__scopeId","data-v-7ce8dee2"]]);wx.createComponent(o);
