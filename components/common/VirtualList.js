"use strict";const e=require("../../common/vendor.js");Math||t();const t=()=>"../../uni_modules/roc-icon-plus/components/roc-icon-plus/roc-icon-plus.js",l={__name:"VirtualList",props:{items:{type:Array,default:()=>[]},itemHeight:{type:Number,default:60},height:{type:String,default:"100%"},bufferSize:{type:Number,default:5},itemKey:{type:[String,Function],default:"id"},loading:{type:Boolean,default:!1},scrollWithAnimation:{type:Boolean,default:!1},lowerThreshold:{type:Number,default:50},currentPlayIndex:{type:Number,default:-1},isPlaying:{type:Boolean,default:!1},darkMode:{type:Boolean,default:!1}},emits:["scroll","scrolltolower","item-click","more-click"],setup(t,{expose:l,emit:o}){const a=t,i=o,r=e.getCurrentInstance(),u=e.ref(0),n=e.ref(0),s=e.ref(0),c=e.ref(0),m=e.ref(a.itemHeight),d=e.computed(()=>(c.value,u.value)),f=e.computed(()=>{const e=Math.floor(s.value/m.value)-a.bufferSize;return Math.max(0,e)}),p=e.computed(()=>{const e=Math.ceil(n.value/m.value),t=f.value+e+2*a.bufferSize;return Math.min(a.items.length,t)}),v=e.computed(()=>a.items.slice(f.value,p.value)),g=e.computed(()=>f.value*m.value),h=e.computed(()=>{const e=a.items.length-p.value;return Math.max(0,e*m.value)}),y=e.computed(()=>a.height),b=(e,t)=>"function"==typeof a.itemKey?a.itemKey(e,t):e[a.itemKey]||t,x=e=>{s.value=e.detail.scrollTop,i("scroll",e)},M=()=>{i("scrolltolower")},S=e=>a.currentPlayIndex===e,k=(e,t="name",l="、")=>{if(!e)return"未知歌手";if(Array.isArray(e)){const o=[];return e.forEach(e=>{let l=e[t];l&&o.push(l)}),o.length>0?o.join(l):"未知歌手"}return String(e||"未知歌手")},T=e=>{if(!e)return"00:00";if("string"==typeof e&&e.includes(":"))return e;let t,l=Number(e);if(isNaN(l))return"00:00";t=l>3600?Math.floor(l/1e3):Math.floor(l);const o=t%60;return`${Math.floor(t/60).toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`},V=e=>"SQ"===e.quality||e.sq||e.h||e.hr||e.types&&e.types.some(e=>"SQ"===e.type);return e.watch(()=>a.items.length,(e,t)=>{console.log("[VirtualList] 列表长度变化:",t,"->",e)}),l({scrollToIndex:(e,t=!0)=>{if(e<0||e>=a.items.length)return void console.warn("[VirtualList] scrollToIndex: 索引超出范围",e);console.log("[VirtualList] scrollToIndex:",e,"actualItemHeight:",m.value);const l=e*m.value;console.log("[VirtualList] 计算滚动位置:",l,"当前scrollTop:",s.value),c.value++,u.value=l,console.log("[VirtualList] 已设置 scrollTopValue:",l,"forceScrollFlag:",c.value)},scrollTo:(e,t=!0)=>{c.value++,u.value=e},getVisibleRange:()=>({start:f.value,end:p.value})}),e.onMounted(()=>{setTimeout(()=>{e.index.createSelectorQuery().in(r).select(".virtual-list").boundingClientRect(e=>{e&&(n.value=e.height,console.log("[VirtualList] 视口高度:",n.value))}).exec(),setTimeout(()=>{e.index.createSelectorQuery().in(r).select(".song-item").boundingClientRect(e=>{e&&e.height>0?(m.value=e.height,console.log("[VirtualList] 实际项目高度:",e.height,"px")):console.log("[VirtualList] 使用默认项目高度:",a.itemHeight)}).exec()},200)},100)}),(l,o)=>e.e({a:g.value+"px",b:e.f(v.value,(l,o,a)=>{var r,u,n,s;return e.e({a:e.t(f.value+o+1),b:e.t(l.name),c:V(l)},(V(l),{}),{d:e.t(k(l.ar||l.singer)),e:(null==(r=l.al)?void 0:r.name)||l.album||l.albumName},(null==(u=l.al)?void 0:u.name)||l.album||l.albumName?{f:e.t((null==(n=l.al)?void 0:n.name)||l.album||l.albumName)}:{},{g:S(f.value+o)&&t.isPlaying},S(f.value+o)&&t.isPlaying?{h:"f66f38f5-0-"+a,i:e.p({name:"play",size:"18"})}:{},{j:e.t(T(l.dt||l.interval||l.duration)),k:"f66f38f5-1-"+a,l:e.o(e=>((e,t)=>{i("more-click",{index:e,item:t})})(f.value+o,l),b(l,o)),m:b(l,o),n:(s=f.value+o,`virtual-item-${s}`),o:S(f.value+o)?1:"",p:e.o(e=>((e,t)=>{i("item-click",{index:e,item:t})})(f.value+o,l),b(l,o))})}),c:e.p({name:"ellipsis-vertical",size:"18"}),d:t.darkMode?1:"",e:h.value+"px",f:0===t.items.length&&!t.loading},0!==t.items.length||t.loading?{}:{g:e.p({name:"music",size:"48",color:t.darkMode?"#666":"#ccc"}),h:t.darkMode?"#666":"#999",i:t.darkMode?"#555":"#ccc"},{j:t.loading},(t.loading,{}),{k:y.value,l:e.o(x),m:d.value,n:t.scrollWithAnimation,o:t.lowerThreshold,p:e.o(M)})}},o=e._export_sfc(l,[["__scopeId","data-v-f66f38f5"]]);wx.createComponent(o);
